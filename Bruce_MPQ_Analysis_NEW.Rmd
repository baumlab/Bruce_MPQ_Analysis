---
title: "Bruce_MPQ_Analysis_NEW- Updated as of July 11, 2020"
author: "Kevin Bruce"
date: "03/07/2020"
output: 
  html_document:
    toc: yes
    toc_depth: 3
    toc_float: yes
---

```{r Load Packages, include=FALSE}
#Load in Packages
library(dplyr)
library(ggplot2)
library(stats)
library(Rmisc)
library(here)
library(ggpmisc)
library(knitr)
library(magick)
library(gridExtra)
library(car)
library(tidyr)
```


# Introduction 
Kiritimati Research Project- PPQ rugosity analyses 2015 - 2019

PPQ = Permanent Photoquadrat (16m2)

This document is for the PPQ data collected on Kiritimati to look at rugosity changes that occur on reefs following a mass mortality event.

The plots below show a view of the data across different spatial and temporal scales. We will start by looking at the data broadly before zooming in to specific PPQ fluctuations over time. 

It is important to note that Sites 15 and 19 (both within the Very Low disturbance category) were unable to be sampled in March 2016 & 2019 due to weather. Site 37 (VL4) was installed in 2017 and has been sampled in both 2017 and 2019. 

```{r map, echo=FALSE, fig.height=11, fig.width=7, fig.align="center"}
map <- image_read("Map/KI_map_sites_villages_inset_KB_MSc_CH1_MPQ.png")
map

```


## Site data available
Below is a table indicating the various sites around Kiritimati and how many MPQ's were sampled during each expedition

```{r Table for Julia, echo=FALSE, fig.align="center"}
map4 <- image_read("Map/sites_sampled_updated.png")
map4

```


## There are 6 complexity metrics collected from each MPG
1. Habitat Volumetric Change
2. Surface Rugosity
3. Terrain Ruggedness (VRM)
4. Slope
5. Profile Curvature
6. Planform Curvature

This document will take us through each of these metrics at various levels of detail. Starting broad, we'll eventually be looking at the individual plot's changes through out the years and across DEM scales (except Volumetric Change, which cannot be examined at different resolution scales).


# Habitat Volumetric Change

Volumetric change between 2015-2017 and 2015-2019 was quantified in CloudCompare, with the change between 

2017 - 2019 calculated algebraically from the equation below:
#### 2017 - 2019 Change = (2015-2019 Change) - (2015-2017 Change)


```{r Load Data, include=FALSE}
#dev.off()
rm(list=ls())

#Load mpq data
mpq <- read.csv(here("Data","ArcMap.Complexity.Data.Final.csv"))
mpq

```

```{r clean ArcMap,CloudCompare mpq data, include=FALSE}
str(mpq)
colnames(mpq)

#Change some collum header titles
#colnames(mpq)[which(names(mpq)=="Year")] <- "year"
#colnames(mpq)[which(names(mpq)=="Site")] <- "site"
colnames(mpq)[which(names(mpq)=="plot")] <- "ppq"
colnames(mpq)[which(names(mpq)=="DEM.scale")] <- "DEM"
colnames(mpq)[which(names(mpq)=="Complexity.Calculation")] <- "rug"
colnames(mpq)[which(names(mpq)=="Avg..BTM_Slope")] <- "slope"
colnames(mpq)[which(names(mpq)=="Avg_terrain_ruggedness..VRM."  )] <- "vrm"
colnames(mpq)[which(names(mpq)=="profile.curvature")] <- "pro.curv"
colnames(mpq)[which(names(mpq)=="planform.curvature")] <- "plan.curv"
colnames(mpq)[which(names(mpq)=="average.curvature")] <- "curv"

colnames(mpq)

#Create new dataframe pulling over only collumms I need
mpq1 <- subset(mpq, select = c("year", "hum_dist","site", "ppq", "SHAPE_Area", "rug", "slope", "vrm", "DEM", "pro.curv", "plan.curv"))

#Switch it back to mpq
mpq <- mpq1
str(mpq)

#Change DEM, Site, Year,Plot all to character
mpq$DEM <- as.character(mpq$DEM)
mpq$site <- as.character(mpq$site)
mpq$year <- as.character(mpq$year)
mpq$ppq <- as.character(mpq$ppq)

str(mpq)

#Change levels of hum_dist & site
levels(mpq$hum_dist)
mpq$hum_dist <- factor(mpq$hum_dist, levels = c("Very High", "High", "Medium", "Low", "Very Low" ))
mpq$site <- factor(mpq$site, levels =c("27", "30", "32", "8", "34", "35", "5", "15", "19", "37"))

#####Subset Data based on DEM Size ####
#Make a subset for 1cm DEM 
mpq.1 <- mpq[mpq$DEM == 1,] 

#Reorder sites so they fit in as VH --> M --> VL
mpq.1$site <- factor(mpq.1$site, levels = c("27", "30", "32", "8", "34", "35", "5", "15", "19", "37"))

#Make Unique collumns for Site.plot
mpq.1$site.ppq <- paste(mpq.1$site, mpq.1$ppq, sep=".")


#Make a subset for 8cm DEM 
mpq.8 <- mpq[mpq$DEM == 8,]

#Reorder sites so they fit in as VH --> M --> VL
mpq.8$site <- factor(mpq.8$site, levels = c("27", "30", "32", "8", "34", "35", "5", "15", "19", "37"))

#Make Unique collumns for Site.plot
mpq.8$site.ppq <- paste(mpq.8$site, mpq.8$ppq, sep=".")  

#Change the levels of this dataframe so that the sites are arranged correctly
levels(mpq.1$site.plot)
mpq.1$site.ppq <- factor(mpq.1$site.ppq, levels=c("27.1", "27.2", "27.3", "30.1", "30.2", "30.3", "32.1", "32.2", "32.3", "8.1", "8.2", "8.3", "34.1", "34.2", "34.3", "5.1", "5.2", "5.3", "15.1", "15.2", "15.3", "19.1", "19.2", "19.3", "37.1", "37.2", "37.3"))
levels(mpq.1$site.ppq)

levels(mpq$hum_dist)
mpq$hum_dist <- factor(mpq$hum_dist, levels = c("Very High", "High", "Medium", "Low", "Very Low" ))



####Subset Data based on Human Disturbance Level####
#Make a subset for Very High human disturbance
mpq.vh <- mpq[mpq$hum_dist == "Very High",] 
mpq.vh

#Make a subset for Medium human disturbance
mpq.m <- mpq[mpq$hum_dist == "Medium",] 

#Make a subset for Low human disturbance
mpq.vl <- mpq[mpq$hum_dist == "Very Low",] 

####Make Unique collumns for Site.plot
mpq.vh$site.plot <- paste(mpq.vh$site, mpq.vh$plot, sep=".")

#Change the levels of this dataframe so that the sites are arranged correctly
levels(mpq.8$site.ppq)
mpq.8$site.ppq <- factor(mpq.8$site.ppq, levels=c("27.1", "27.2", "27.3", "30.1", "30.2", "30.3", "32.1", "32.2", "32.3", "8.1", "8.2", "8.3", "34.1", "34.2", "34.3", "5.1", "5.2", "5.3", "15.1", "15.2", "15.3", "19.1", "19.2", "19.3", "37.1", "37.2", "37.3"))
levels(mpq.8$site.ppq)

#Subset plan and pro curv values to convert to proper Z units
mpq.curv <- subset(mpq, select = c("pro.curv", "plan.curv", "DEM", "year"))

#Add collumn for z-units
mpq.curv$pro.z <- "a"
mpq.curv$plan.z <- "b"

#Convert the curvature values to Z values (basically just divide them by 100)
mpq.curv$pro.z <- mpq.curv[,"pro.curv"]/100
mpq.curv$plan.z <- mpq.curv[,"plan.curv"]/100

```

```{r Clean CloudCompare Data, include=FALSE}
#Load CloudCompare data
CC <- read.csv(here("Data", "MPQ_CloudCompare_Data.csv"))

#Remove the extra collums in the cloudcompare data that aren't necessary
CC <- subset(CC, select = c("hum_dist","timepoint", "site", "mpq", "volume.change" ))
CC

#Delete the extra rows in the dataframe with NA's
CC <- CC[-c(72,73,74,75,76,77,78,79,80),]
CC

#Check structure of CC
str(CC)   ###human_dist is a factor, which we need to change to a character

#Change hum_dist and mpq to a character
CC$hum_dist <- as.character(CC$hum_dist)
CC$mpq <- as.character(CC$mpq)

str(CC)

#Assign levels to CC$hum_dist
levels(CC$hum_dist)
CC$hum_dist <- factor(CC$hum_dist, levels = c("Very Low", "Medium", "Very High"))
levels(CC$hum_dist)

#Change timepoint information from A, B,C to year differences
CC$timepoint <- factor(CC$timepoint, levels =c("A", "B", "C"), labels = c("2015-2017", "2017-2019", "2015-2019"))

#Change levels of sites to match disturbance level
CC$site <- factor(CC$site, levels = c("27", "30", "32", "8", "34", "35", "5", "15", "19", "37"))


#Make a subset for all data not including medium sites
CC.1 <- CC[CC$hum_dist == "Very Low",]
CC.2 <- CC[CC$hum_dist == "Very High",]

#Merge both files
CC.3 <- rbind(CC.1, CC.2)
CC.3

#Finally, make a dataframe that has deleted rows from the middle timepoint
CC.4 <- CC.3[!grepl("2017-2019", CC.3$timepoint),]


#Vaskess bay sites
CC.v <- subset(CC, site == 5| site == 37) 
CC.bow <- subset(CC, site == 15| site == 19)





##### REPEAT ALL DATA CHANGES FOR NEW data ###
#Load Newer CloudCompare data
CC.new <- read.csv(here("Data", "CloudCompare.Data.New.csv"))


#Remove the extra collums in the cloudcompare data that aren't necessary
CC.new <- subset(CC.new, select = c("Hum_Dist","Period", "Site", "MPQ", "Volume", "Added.Volume", "Removed.Volume" ))
CC.new


#Change colnames for the collumns
colnames(CC.new)[which(names(CC.new)=="Hum_Dist")] <- "hum_dist"
colnames(CC.new)[which(names(CC.new)=="Period")] <- "timepoint"
colnames(CC.new)[which(names(CC.new)=="MPQ")] <- "mpq"
colnames(CC.new)[which(names(CC.new)=="Site")] <- "site"
colnames(CC.new)[which(names(CC.new)=="Volume")] <- "volume.change"
colnames(CC.new)[which(names(CC.new)=="Added.Volume")] <- "volume.added"
colnames(CC.new)[which(names(CC.new)=="Removed.Volume")] <- "volume.removed"

colnames(CC.new)



#Delete the extra rows in the dataframe with NA's
#CC <- CC[-c(72,73,74,75,76,77,78,79,80),]
#CC

#Check structure of CC
str(CC.new)   ###human_dist is a factor, which we need to change to a character

#Change hum_dist and mpq to a character
CC.new$hum_dist <- as.character(CC.new$hum_dist)
CC.new$mpq <- as.character(CC.new$mpq)

str(CC.new)

#Assign levels to CC$hum_dist
levels(CC.new$hum_dist)
CC.new$hum_dist <- factor(CC.new$hum_dist, levels = c("Very Low", "Medium", "Very High"))
levels(CC.new$hum_dist)

#Change timepoint information from A, B,C to year differences
#CC.new$timepoint <- factor(CC.new$timepoint, levels =c("A", "B", "C"), labels = c("2015-2017", "2017-2019", "2015-2019"))

#CC.new

#Remove 2015-2017 timepoint
CC.new.2.timepts <- subset (CC.new, timepoint == "A" | timepoint == "C") 
CC.new.2.timepts
CC.new

CC.new.2.timepts$timepoint <- factor(CC.new.2.timepts$timepoint, levels =c("A", "B", "C"), labels = c("2015-2017", "2017-2019", "2015-2019"))


#Change levels of sites to match disturbance level
CC.new$site <- factor(CC.new$site, levels = c("27", "30", "32", "8", "34", "35", "5", "15", "19", "37"))


#Make a subset for all data not including medium sites
CC.new.1 <- CC.new[CC.new$hum_dist == "Very Low",]
CC.new.2 <- CC.new[CC.new$hum_dist == "Very High",]

#Merge both files
CC.new.3 <- rbind(CC.new.1, CC.new.2)
CC.new.3

#Finally, make a dataframe that has deleted rows from the middle timepoint
CC.new.4 <- CC.new.3[!grepl("2017-2019", CC.new.3$timepoint),]


#Vaskess bay & BOW sites
CC.new.v <- subset(CC.new, site == 5| site == 37) 
CC.new.bow <- subset(CC.new, site == 15| site == 19)
```

```{r load and clean digitization data, echo=FALSE}
#Load Data for digitization
library(readxl)
dig <- read_excel(here("Data", "MPQ.Digitization.Data.xlsx"))

#Turn into numeric
dig$SHAPE_Area[is.na(dig$SHAPE_Area)] <- 0
dig$SHAPE_Area <- as.numeric(dig$SHAPE_Area)

#Rename shape_area to area
colnames(dig)[which(names(dig)=="SHAPE_Area")] <- "area"
colnames(dig)[which(names(dig)=="Year")] <- "year"

#Make new dataframe without unneeded collums
#dig <- subset(dig, c= ())

# Make a unique collum for year.site.ppq
#dig$year.site.ppq <- paste(dig$year, dig$site, dig$ppq, sep=",")

colnames(dig)
dig


#### What I need to do:#### DOM HELP PLEASE
#1. Summarize the total shape area for each year.site.ppq combination by benthic morphology
#2. Calculate the % of each morphology at each plot & Graph the proportion of  each morphology present at each plot using stacked bar charts
#3. Create a new dataframe with same data from step 2, but convert all live_encrusting category tags to either dead_massive OR rubble (based on the one category left til the end of each plot) --> Via a 4-loop?
#4. Repeat Step 2 for the new dataframe constructed in step 3


# Summarize shape.area by site.ppq and benthic_morphology
dig.sum <- spread(dig, Benthic_Morphology, fill = 0)

#dig.sum.test <- subset(dig, year == "2015" & hum_dist == "Very High" & site == "27" & ppq == "3" & Benthic_Morphology == "Dead_Branching")






######
##### WHAT DOM DID FOR ME WITH OTHER MPQ WORK, BUT THIS WAS AFTER CORALNET SUMMARIZED IT ALL#####

#Change to long format dataframe
mpq_benthos_long <- gather(mpq_benthos, Substance, Prop.Cover, LiveCoral:TurfAlgae)

#Change site to a factor
str(mpq_benthos_long)
mpq_benthos_long$Site <- as.factor(mpq_benthos_long$Site)

#Create Unique ID for Site.mpq
mpq_benthos_long$Site.MPQ <- paste(mpq_benthos_long$Site, mpq_benthos_long$MPQ, sep=".")


#Make a bar plot for the proportion of each coral cover type at each plot
ggplot(dig, aes(x = site.ppq, y= SHAPE_Area)) + ggtitle("Benthic Compositon") + geom_bar(stat = 'identity', position = "stack")+facet_wrap(~site.ppq, scales = "fixed", ncol= 3)


ggplot(mpq_benthos_long, aes(x = Site.MPQ, y= Prop.Cover, fill= Substance)) + ggtitle("Benthic Compositon") + geom_bar(stat = 'identity', position = "stack")


```

## Year Level

When looking at volumetric change by time point for all plots measured, we see the following:

- Appears that 2015-2017 losses occur, which is similar to what Jenn's study found

- While losses in 2015-2019 were experienced, greatest losses of volume appear to occur from 2015-2017, which is interesting as while collecting the data, I felt that these values could have been higher if that large matt of macro algae wasn't present in many of the 2017 plots.


```{r CC 1, echo=FALSE}
ggplot(CC, aes(x = timepoint, y=volume.change)) + geom_boxplot(fill="deepskyblue") + theme_classic(base_size = 10) + xlab("Timepoint") + ylab("Volume Change (m3)")+ theme(plot.title = element_text(hjust = 0.5))+ theme(plot.title = element_text(size=14))+ theme(plot.title = element_text(size=22))+ geom_hline(yintercept = 0, linetype="dashed", color="red", size=0.2) + scale_y_continuous(breaks=seq(-2.5,1,0.2)) + geom_label(label= "p=0.56", x= 3, y=0.9, label.size= 0.5, label.padding= unit(0.5, "lines"), fill= "grey", color="black")

a1 <- aov(volume.change~timepoint, data = CC)
#summary(a1)

#kruskal.test(volume.change~timepoint, data = CC) #p=0.4511




###ADDED GRAPHS###
CC.100 <- ggplot(CC.new.2.timepts, aes(x = timepoint, y=volume.change)) + geom_boxplot(fill="deepskyblue") + theme_classic(base_size = 10) + xlab("Timepoint") + ylab("Volume Change (m3)")+ theme(plot.title = element_text(hjust = 0.5))+ theme(plot.title = element_text(size=14))+ theme(plot.title = element_text(size=22))+ geom_hline(yintercept = 0, linetype="dashed", color="red", size=0.2) + scale_y_continuous(breaks=seq(-2.5,1,0.2)) #+ geom_label(label= "p=0.56", x= 3, y=0.9, label.size= 0.5, label.padding= unit(0.5, "lines"), fill= "grey", color="black")

#Volume added
CC.101 <- ggplot(CC.new.2.timepts, aes(x = timepoint, y=volume.added)) + geom_boxplot(fill="deepskyblue") + theme_classic(base_size = 10) + xlab("Timepoint") + ylab("Volume Change (m3)")+ theme(plot.title = element_text(hjust = 0.5))+ theme(plot.title = element_text(size=14))+ theme(plot.title = element_text(size=22))+ geom_hline(yintercept = 0, linetype="dashed", color="red", size=0.2) + scale_y_continuous(breaks=seq(-2.5,1,0.2)) #+ geom_label(label= "p=0.56", x= 3, y=0.9, label.size= 0.5, label.padding= unit(0.5, "lines"), fill= "grey", color="black")

#Volume removed
CC.102 <- ggplot(CC.new.2.timepts, aes(x = timepoint, y=volume.removed)) + geom_boxplot(fill="deepskyblue") + theme_classic(base_size = 10) + xlab("Timepoint") + ylab("Volume Change (m3)")+ theme(plot.title = element_text(hjust = 0.5))+ theme(plot.title = element_text(size=14))+ theme(plot.title = element_text(size=22))+ geom_hline(yintercept = 0, linetype="dashed", color="red", size=0.2) + scale_y_continuous(breaks=seq(-2.5,1,0.2)) #+ geom_label(label= "p=0.56", x= 3, y=0.9, label.size= 0.5, label.padding= unit(0.5, "lines"), fill= "grey", color="black")

grid.arrange(CC.100,CC.101, CC.102, nrow=3)







```

Statistical Results:

- No significant differences between time points with a one-way ANOVA

- No significant differences between time points with a Kruskal-Wallis test


## Disturbance Level
Now breaking it down by disturbance level, losses in very high and very low disturbance sites are noted (in both 2015-2017 and 2015-2019 time frames). 

- Greatest losses of volume appear to occur from 2015-2017, which is interesting. While collecting the data, I felt that these values could have been higher if that large matt of macro algae wasn't present in many of the 2017 plots 

Interestingly, the medium disturbance sites experienced minimal losses in volume. This was seen in Jenn's study as well, and I hypothesize this lack of loss could be due to multiple causes:

1. These plots are well cemented together and have minimal coral species that are quickly eroded away once they die (Ex: Branching/Plating species). 

2. The mass algae bloom in 2017 might obscure how much loss occurred at these plots from 2015-2017, which is when I would expect the largest losses to occur (IE: there isn't enough time within that time point for new coral growth to offset the losses in other coral structure) 

By doing an ANOVA between volume change & time point, I got a P value of 0.147

Via a linear model with an interaction between time point and human disturbance, P = 0.4164 overall, with no coefficients having a significant p-value. 

- However, from help by Dom, my Q-Q plot indicates the data isn't normally distributed so perhaps try a different distribution? 

```{r Plot CC Data by Timepoint & disturbance, echo=FALSE}
ggplot(CC, aes(x = timepoint, y=volume.change, fill = hum_dist)) + geom_boxplot() + theme_classic(base_size = 14) + xlab("Timepoint") + ylab("Volumetric Change(m3)")+ theme(plot.title = element_text(hjust = 0.5))+ theme(plot.title = element_text(size=22))+ geom_hline(yintercept = 0, linetype="dashed", color="red", size=0.2)+ scale_y_continuous(breaks=seq(-2.5,1,0.2))


#CC.2.anova <- aov(volume.change~timepoint + hum_dist, data = CC)
#summary(CC.2.anova)


```

Here I broke down the volumetric changes by disturbance level differently, and I think this tells the story a bit better. 

Very Low Sites: This seems accurate. These sites experienced losses in structure (primarily through disappearance of branching and plating corals). 

Medium Sites: Minimal losses experienced across the board. Refer above to see my hypotheses on why.

Very High Sites: These sites are predominantly rubble, and therefore the "volume" of the plot at a specific year will be highly dependent on the rubble present. From visual inspection, there are few features that remain consistent throughout the years.

```{r CC facetwrapped by disturbance level, echo=FALSE}
ggplot(CC, aes(timepoint, volume.change)) + geom_boxplot() +facet_wrap(~hum_dist, scales = "fixed", ncol= 3) + xlab("Human Disturbance Level") + ylab("Volumetric Change(m3)")+ theme(plot.title = element_text(hjust = 0.5))+ theme(plot.title = element_text(size=22)) + theme(plot.title = element_text(size=22))+ geom_hline(yintercept = 0, linetype="dashed", color="red", size=0.2)+ theme(axis.text.x = element_text(angle = 45, vjust = 1.1, hjust=1))


#a2 <- aov(volume.change~hum_dist, data = CC)
#summary(a2)     
#kruskal.test(volume.change~hum_dist, data = CC)  #p=0.1846


```

```{r dist anova 1, echo=FALSE}

#a3 <- lm(CC$volume.change~CC$timepoint*CC$hum_dist)
#summary(a3)

##Linear model residual plots to show julia

#par(mfrow=c(2,2))
#plot(a3)

##par(mfrow=c(1,1))


#Comment: Not normally distributed, look at glm of some kind


#hist(CC$volume.change)



```

## Vaskess Bay

** I believed that this trend seen at medium sites might be similar in Vaskess bay as well, as sites 5 and 37 coral communities appear more similar to the medium sites than the other VL disturbance sites in the Bay of Wrecks (from my personal recollection- it will be interesting to see what the digitization tells us). 

However, after graphing this, it highlighted:

- Site 5, which is the only site sampled in 2015-2017, experienced an increase in volume  oddly enough.

- In 2015-2019, it experienced the decrease that we expected to see.

- From looking at the data, its Site 5 MPQ2 in particular that is causing this issue (as it increased in volume by 0.892 from 2015-2017)


```{r vaskess sites, echo=FALSE}
ggplot(CC.v, aes(x = timepoint, y=volume.change, fill = hum_dist)) + geom_boxplot() + theme_classic(base_size = 14) + xlab("Timepoint") + ylab("Volumetric Change(m3)")+ theme(plot.title = element_text(hjust = 0.5))+ theme(plot.title = element_text(size=22))+ geom_hline(yintercept = 0, linetype="dashed", color="red", size=0.2)+ scale_y_continuous(breaks=seq(-2.5,1,0.2)) +geom_label(label= "p=0.24", x= 3, y=0.9, label.size= 0.5, label.padding= unit(0.5, "lines"), fill= "grey", color="black")


a4 <- aov(volume.change~timepoint, data = CC.v)
summary(a4)
TukeyHSD(a4)

```

Statistical Results:

- No significant differences between time points


## Bay of Wrecks

I did the same graph for only the Bay of Wrecks sites. It is less interesting as these are only available for 1 time point, but we can see the anticipated volume loss similar to what Jenn Magel found.

```{r BOW, echo=FALSE}
ggplot(CC.bow, aes(x = timepoint, y=volume.change, fill = hum_dist)) + geom_boxplot() + theme_classic(base_size = 14) + xlab("Timepoint") + ylab("Volumetric Change(m3)")+ theme(plot.title = element_text(hjust = 0.5))+ theme(plot.title = element_text(size=22))+ geom_hline(yintercept = 0, linetype="dashed", color="red", size=0.2)+ scale_y_continuous(breaks=seq(-2.5,1,0.2)) 

```


## Year- Medium Sites Removed

If we remove the medium sites, these are the trends that are present at the year scale. 

- Both 2015-2017 and 2015-2019 time points experienced more pronounced losses when medium sites are removed (unsure if significant)

- The 2017-2019 time point shows a further increase, although I have reservations about it and am not sure where that is coming from. Since this time point was determined algebraically, I'm unsure whether it is as descriptive as it should be. 

```{r CC2 no medium sites, echo=FALSE}
ggplot(CC.3, aes(x = timepoint, y=volume.change)) + geom_boxplot(fill="deepskyblue") + theme_classic(base_size = 10) + xlab("Timepoint") + ylab("Volume Change (m3)")+ theme(plot.title = element_text(hjust = 0.5))+ theme(plot.title = element_text(size=14))+ theme(plot.title = element_text(size=22))+ geom_hline(yintercept = 0, linetype="dashed", color="red", size=0.2)+geom_label(label= "p=0.388", x= 3, y=0.9, label.size= 0.5, label.padding= unit(0.5, "lines"), fill= "grey", color="black")

#a5 <- aov(volume.change~timepoint, data = CC.3)
#summary(a5)

```

Statistical Results:

- No significant differences between time points

## Site Level 

```{r CC DAta by site, echo=FALSE}

ggplot(CC, aes(timepoint, volume.change, fill = timepoint)) + geom_boxplot() +facet_wrap(~site, scales = "fixed", ncol= 3) + xlab("PPQ") + ylab("Volumetric Change (m3)")+ theme(plot.title = element_text(hjust = 0.5))+ theme(plot.title = element_text(size=22))+ theme(axis.text.x = element_text(angle = 20, vjust = 1.1, hjust=1))



#CC.3.anova <- aov(volume.change~timepoint + hum_dist + site, data = CC)
#summary(CC.3.anova)

```

## PPQ Level

To try to see if any specific plots could be skewing the data, I examined volumetric changes at the three time points based on the PPQ.

```{r CC Data by plot, echo=FALSE}
ggplot(CC, aes(mpq, volume.change, colour = timepoint)) + geom_boxplot() +facet_wrap(~site, scales = "fixed", ncol= 3) + xlab("PPQ") + ylab("Volumetric Change (m3)")+ theme(plot.title = element_text(hjust = 0.5))+ theme(plot.title = element_text(size=22))



#CC.4.anova <- aov(volume.change~timepoint + site + mpq + hum_dist, data = CC)
#summary(CC.4.anova)

```


From this plot, the following site/plot combinations jump out at me:

- Site 30 MPQ 2, 3 - both illustrate plot volume increases as time progresses, which I attest to the large amounts of rubble that blow through the VH plots. MPQ 2 had a large boulder move between during 2015-2017, while the overhaul of all other rubble components at this site varied from year to year (but given the values, more and more settled)

- Site 34 MPQ 1 & Site 35 MPQ 1,3 - all show increases in volume. Unsure exactly why....

- Site 5 MPQ 1, MPQ 2- Large increases in volume from 2015-2017 are seen in these plots. 


I need to look at these plots between the two years and see what could be driving these results we are seeing.



# ArcMap Complexity Metrics

For all plots, all sites are included, even if they were only sampled in 2 of the 3 time points (Notably, sites 15, 19, and 37)

## Year Level
The complexity metrics are averaged at the year level, showing each metrics average values around the atoll at the three time points (2015,2017,2019). 

### Surface Rugosity 

- Surface rugosity exhibited decreases between 2015 and 2017 at both DEM scales, as expected due to Jenn's previously results

- However, these losses didn't continue in 2019

- I hypothesize this is due to the following:

- The initial declines seen between 2015 and 2017 was due to the mass die-off and subsequent bio-erosion of the more complex coral (branching and plating) species. 

- However, I observed that many of these species had eroded away by 2017, thereby not leaving behind much else to erode away in large amounts.

- The portions of the plot that did erode away between 2017-2019 were offset by both rubble settling in the plot area and/or the growth of the prevailing coral species in the plot area. 

```{r SR by year and by DEM, echo=FALSE}
#ggplot(mpq, aes(x = year, y=rug)) + geom_boxplot(fill="deepskyblue") + theme_classic(base_size = 10) +facet_wrap(~DEM, scales = "fixed", ncol= 2)+ xlab("Year") + ylab("Surface Rugosity") + geom_label(label= "p=0.00394", x= 3, y=2.6, label.size= 0.2, label.padding= unit(0.2, "lines"), fill= "grey", color="black")

SR1 <- ggplot(mpq.1, aes(x = year, y=rug)) + geom_boxplot(fill="deepskyblue") + theme_classic(base_size = 10) +facet_wrap(~DEM, scales = "fixed", ncol= 2)+ xlab("Year") + ylab("Surface Rugosity") + geom_label(label= "p=0.00394", x= 3, y=2.6, label.size= 0.2, label.padding= unit(0.2, "lines"), fill= "grey", color="black")

SR2 <- ggplot(mpq.8, aes(x = year, y=rug)) + geom_boxplot(fill="forestgreen") + theme_classic(base_size = 10) +facet_wrap(~DEM, scales = "fixed", ncol= 2)+ xlab("Year") + ylab("Surface Rugosity") + geom_label(label= "p=0.433", x= 2, y=1.5, label.size= 0.2, label.padding= unit(0.2, "lines"), fill= "grey", color="black")

grid.arrange(SR1, SR2, nrow=2)

a7 <- aov(rug~year, data = mpq.1)
#summary(a7)
#TukeyHSD(a7)

a8 <- aov(rug~year, data = mpq.8)
#summary(a8)
#TukeyHSD(a8)

```

Statistical Results:

- There is a significant difference between years and SR values at 1cm DEM

- 2015 - 2017 are significantly different, as are 2015-2019; 2017 - 2019 are not significantly different

- There is no significant difference between years and SR values at 8cm DEM



### Terrain Ruggedness by year

- The changes between the years are more pronounced in the terrain ruggedness values than those of surface rugosity.

- As this metric is more sensitive than surface rugosity to fine-scale complexity changes, I believe the larger increase we see from 2017-2019 is due to the amount of ruble increasing in the plots.

- Additionally, I believe the values would actually be lower in the 2017 plots, however the presence of large amounts of macro algae in many of the plots hid this.

```{r TR by yr, echo=FALSE}
#ggplot(mpq, aes(x = year, y=vrm)) + geom_boxplot(fill="deepskyblue") + theme_classic(base_size = 10) +facet_wrap(~DEM, scales = "fixed", ncol= 2)+ xlab("Year") + ylab("Terrain Ruggedness")

TR1 <- ggplot(mpq.1, aes(x = year, y=vrm)) + geom_boxplot(fill="deepskyblue") + theme_classic(base_size = 10) +facet_wrap(~DEM, scales = "fixed", ncol= 2)+ xlab("Year") + ylab("Terrain Ruggedness") + geom_label(label= "p=5.83E-7", x= 2, y=0.1, label.size= 0.2, label.padding= unit(0.2, "lines"), fill= "grey", color="black")

TR2 <-ggplot(mpq.8, aes(x = year, y=vrm)) + geom_boxplot(fill="forestgreen") + theme_classic(base_size = 10) +facet_wrap(~DEM, scales = "fixed", ncol= 2)+ xlab("Year") + ylab("Terrain Ruggedness") +geom_label(label= "p=0.306", x= 2, y=0.1, label.size= 0.2, label.padding= unit(0.2, "lines"), fill= "grey", color="black")


a9<- aov(vrm~year, data = mpq.1)
#TukeyHSD(a9)

a10<- aov(vrm~year, data = mpq.8)
#TukeyHSD(a10)


grid.arrange(TR1, TR2, nrow=2)

#summary(a9)
#summary(a10)

```

Statistical Results:

- At 1cm DEM, each time point is significantly different from one another [2015-2017 (P=3.0E-7), 2015-2019 (P=0.0272), 2017-2019 (P=0.00909)]

- There is no significant difference between years and VRM values at 8cm DEM


### Slope
- Slope at 1cm DEM resolution exhibits a similar trend to that of TR, in that a decrease is experienced from 2015-2017, with a similar value to 2017 in 2019.

- At 8cm DEM, the trend was different. There was minimal progressive losses in slope from 2015-2019. Unsure what could have caused this

```{r Slope by yr, echo=FALSE}
#ggplot(mpq, aes(x = year, y=slope)) + geom_boxplot(fill="deepskyblue") + theme_classic(base_size = 10) +facet_wrap(~DEM, scales = "fixed", ncol= 2)+ xlab("Year") + ylab("Slope")

S1 <- ggplot(mpq.1, aes(x = year, y=slope)) + geom_boxplot(fill="deepskyblue") + theme_classic(base_size = 10) +facet_wrap(~DEM, scales = "fixed", ncol= 2)+ xlab("Year") + ylab("Slope") +geom_label(label= "p=0.0237", x= 3, y=47, label.size= 0.2, label.padding= unit(0.2, "lines"), fill= "grey", color="black")

S2<- ggplot(mpq.8, aes(x = year, y=slope)) + geom_boxplot(fill="forestgreen") + theme_classic(base_size = 10) +facet_wrap(~DEM, scales = "fixed", ncol= 2)+ xlab("Year") + ylab("Slope") +geom_label(label= "p=0.586", x= 3, y=36, label.size= 0.2, label.padding= unit(0.2, "lines"), fill= "grey", color="black")

grid.arrange(S1, S2, nrow=2)


a11<- aov(slope~year, data = mpq.1)
a12<- aov(slope~year, data = mpq.8)

#summary(a11)
#summary(a12)

#TukeyHSD(a12)
#plot(TukeyHSD(a11))


```

Statistical Results:

- At 1cm DEM, 2015 and 2017 are significantly different (P = 0.0199587), while 2017- 2019 (P=0.718) and 2015-2019 (P=0.1591954) are not significantly different.

- There is no significant difference between years at 8cm DEM




### Profile Curvature

- The range of values is largest in 2015, with the variability the lowest in 2017 of the 3 time points, especially at the 1cm DEM scale; at 8cm, 2015 and 2019 variability appear to be quite similar. 

- There is a shift from more negative values to more positive ones as we progress throughout time, indicating changes of structure shape in the direction of the maximum slope from outwardly convex to inwardly concave; to me this indicates erosion is occurring, eating away at that surface as the water flows over it. 

```{r ProCurv surf rug by yr, echo=FALSE}
#ggplot(mpq, aes(x = year, y=pro.curv)) + geom_boxplot(fill="deepskyblue") + theme_classic(base_size = 10) +facet_wrap(~DEM, scales = "fixed", ncol= 2)+ xlab("Year") + ylab("Profile Curvature")

Pro1 <- ggplot(mpq.1, aes(x = year, y=pro.curv)) + geom_boxplot(fill="deepskyblue") + theme_classic(base_size = 10) +facet_wrap(~DEM, scales = "fixed", ncol= 2)+ xlab("Year") + ylab("Profile Curvature")+geom_label(label= "p=8.82E-5", x= 2, y=400, label.size= 0.2, label.padding= unit(0.2, "lines"), fill= "grey", color="black")

Pro2 <- ggplot(mpq.8, aes(x = year, y=pro.curv)) + geom_boxplot(fill="forestgreen") + theme_classic(base_size = 10) +facet_wrap(~DEM, scales = "fixed", ncol= 2)+ xlab("Year") + ylab("Profile Curvature")+geom_label(label= "p=0.125", x= 2, y=110, label.size= 0.2, label.padding= unit(0.2, "lines"), fill= "grey", color="black")


grid.arrange(Pro1, Pro2, nrow=2)


a13<- aov(pro.curv~year, data = mpq.1)
#TukeyHSD(a13)

a14<- aov(pro.curv~year, data = mpq.8)
#TukeyHSD(a14)
#summary(a13)
#summary(a14)

```

Statistical Results:

- At 1cm DEM, 2015-2017 (P = 0.0199587) and 2015-2019 (P=0.0001) are significantly different, while 2017-2019 are not significantly different (0.4937).

- There is no significant difference between years at 8cm DEM



### Planform Curvature

- Similar trends seen here to those seen in profile curvature in terms of variability and shift from negative to positive values 

- The shift indicates that the structure is transitioning from concave (negative) to more convex (positive) features perpendicular to the maximum slope of the surface. 

- I believe this is still due to erosion. As water flows along the surface of maximum slope (eroding away that part causing the values we see in the profile curvature), the concave feature is being cut out of the structure in that direction, but in doing so, ridges are created on the edges of eroded surface, which I believe are what are causing these planform values seen.

```{r PlanCurv surf rug by yr, echo=FALSE}
#ggplot(mpq, aes(x = year, y=plan.curv)) + geom_boxplot(fill="deepskyblue") + theme_classic(base_size = 10) +facet_wrap(~DEM, scales = "fixed", ncol= 2)+ xlab("Year") + ylab("Planform Curvature")

Plan1 <- ggplot(mpq.1, aes(x = year, y=plan.curv)) + geom_boxplot(fill="deepskyblue") + theme_classic(base_size = 10) +facet_wrap(~DEM, scales = "fixed", ncol= 2)+ xlab("Year") + ylab("Planform Curvature")+geom_label(label= "p=8.65E-5", x= 2, y=380, label.size= 0.2, label.padding= unit(0.2, "lines"), fill= "grey", color="black")

Plan2 <- ggplot(mpq.8, aes(x = year, y=plan.curv)) + geom_boxplot(fill="forestgreen") + theme_classic(base_size = 10) +facet_wrap(~DEM, scales = "fixed", ncol= 2)+ xlab("Year") + ylab("Planform Curvature")+geom_label(label= "p=0.0211", x= 2, y=100, label.size= 0.2, label.padding= unit(0.2, "lines"), fill= "grey", color="black")


grid.arrange(Plan1, Plan2, nrow=2)


a15<- aov(plan.curv~year, data = mpq.1)
#TukeyHSD(a15)

a16<- aov(plan.curv~year, data = mpq.8)
#TukeyHSD(a16)

#summary(a15)
#summary(a16)

```

Statistical Results:

- At 1cm DEM, 2015-2017 (P=0.0036) and 2015-2019 (P=9.3E-5) are significantly different, while 2017-2019 are not (0.3989)

- At 8cm DEM, 2017-2019 (P=0.0303) is significantly different, while 2015-2019 (P=0.0501483) is close. 2015-2017 is not significantly different.


### Curvature variation

- This is a plot that I have borrowed from Kailey's Hurricane Walaka paper that shows how the dispersion of the two curvature value's density changed after the disturbance event or, in our case, throughout time.

- In this paper, a monitored plot endured a major disturbance event (storm), which caused the range of the curvature density values to shrink, with larger spikes around 0.

- We see this spike in our data in 2017, however in 2019 the spike decreased to levels below that of 2015. There is a noticeable shift from more negative values to more positive values though post-mortality event. 

This shift to more positive values for both curvature values indicate:

1. Profile Curvature: The structure is transitioning from outwardly convex to inwardly concave features, which indicates erosion is occurring. 

2. Planform Curvature: Structure transitioning from negative (concave) features to more positive (convex) values, perpendicular to the maximum slope of the surface. 

- I believe that the planform curvature value is still due to erosion. As water flows along the surface of maximum slope (eroding away that part causing the values we see in the profile curvature), the concave feature is being cut out of the structure in that direction, but in doing so, ridges are created on the edges of eroded surface, which I believe are what are causing these planform values seen.
 
##### Profile Curvature Density Plots

```{r Curv density plots, echo=FALSE}
p1 <- ggplot(mpq, aes(x=pro.curv, fill=year)) + geom_density(alpha=0.2)
p2 <- ggplot(mpq, aes(x=pro.curv)) + geom_density(alpha=0.2)+facet_wrap(~year, scales = "fixed", ncol= 3)

grid.arrange(p1, p2, nrow=2)

```

##### Planform Curvature Density Plots

```{r Plan Curv density plots, echo=FALSE}
p3 <- ggplot(mpq, aes(x=plan.curv, fill=year)) + geom_density(alpha=0.2)
p4 <- ggplot(mpq, aes(x=plan.curv)) + geom_density(alpha=0.2)+facet_wrap(~year, scales = "fixed", ncol= 3)

grid.arrange(p3, p4, nrow=2)

```


## Human Disturbance Gradient Level
Investigates complexity metrics, at both 1cm and 8cm DEM resolutions, across the human disturbance gradient, which contains 3 levels (very high, medium, very low).

All sites were included, including 15, 19, and 37 which were only sampled in 2 of the 3 years


### Surface Rugosity

- Early trends appear similar to what Jenn found (VL disturbance sites have higher SR than VH sites)

- Losses appear to occur at all levels from 2015-2017, however at the medium disturbance sites, this loss is less pronounced, with some plots appearing to experience an increase

- 2019 values almost all show some form of increase in SR from the lowest of lows in 2017. 

```{r SR by disturbance gradient, echo=FALSE}
ggplot(mpq, aes(x = hum_dist, y=rug, fill = year)) + geom_boxplot()+ theme_classic(base_size = 14) + xlab("Human Disturbance Level") + ylab("Surface Rugosity")+ theme(plot.title = element_text(hjust = 0.5))+ theme(plot.title = element_text(size=22))+facet_wrap(~DEM, scales = "fixed", ncol= 2)

```

### Terrain Ruggedness

- More pronounced differences between the disturbance levels are seen here, especially in 2015 at the 1cm DEM scale

- At the 8cm DEM scale, while there are less differences between disturbance levels, a more step-wise pattern is shown between the disturbance levels from lowest values at VH sites to largest values at VL sites

- At 1cm DEM, VH sites have similar values at 2015 and 2019; I believe this is due to rubble transport moving in and out of the plots, making the time at which we sample the plot highly dependent on how prevalent the storms were that year in transporting rubble to and from the plot area

- The increase in TR at the VL sites from 2017 - 2019 is interesting. Unsure what could be causing that.
```{r TR hum_dist, echo=FALSE}
ggplot(mpq, aes(x = hum_dist, y=vrm, fill = year)) + geom_boxplot()+ theme_classic(base_size = 14) + xlab("Human Disturbance Level") + ylab("Terrain Ruggedness")+ theme(plot.title = element_text(hjust = 0.5))+ theme(plot.title = element_text(size=22))+facet_wrap(~DEM, scales = "fixed", ncol= 2)

```

### Slope

- At 1cm DEM, slope decrease in a step-wise pattern at VH and M sites; VL sites experienced an increase from 2017-2019

- The trend is similar at 8cm DEM, however the increase in 2019 TR values is less and the M sites plots indicate that the highest slopes were seen during the 2017 time point. 


```{r Slope, echo=FALSE}
ggplot(mpq, aes(x = hum_dist, y=slope, fill = year)) + geom_boxplot()+ theme_classic(base_size = 14) + xlab("Human Disturbance Level") + ylab("Slope")+ theme(plot.title = element_text(hjust = 0.5))+ theme(plot.title = element_text(size=22))+facet_wrap(~DEM, scales = "fixed", ncol= 2)

```


### Profile Curvature

- At 1cm DEM, all sites experience a similar trend where the profile curvature values shift towards larger, more positive values; this indicates a change in structure shape already discussed

- The very low values seen in in 2015 at the VL sites I attest to the presence of those large plating species that almost entirely disappeared by 2017; interestingly this trend disappears at the 8cm DEM

```{r ProCurv, echo=FALSE}
ggplot(mpq, aes(x = hum_dist, y=pro.curv, fill = year)) + geom_boxplot()+ theme_classic(base_size = 14) + xlab("Human Disturbance Level") + ylab("Profile Curvature")+ theme(plot.title = element_text(hjust = 0.5))+ theme(plot.title = element_text(size=22))+facet_wrap(~DEM, scales = "fixed", ncol= 2)
```


### Planform Curvature

-Similar trends seen here to those seen in Profile Curvature; refer to plot above for hypotheses on why we are seeing these trends. 

```{r PlanCurv, echo=FALSE}
ggplot(mpq, aes(x = hum_dist, y=plan.curv, fill = year)) + geom_boxplot()+ theme_classic(base_size = 14) + xlab("Human Disturbance Level") + ylab("Planform Curvature")+ theme(plot.title = element_text(hjust = 0.5))+ theme(plot.title = element_text(size=22))+facet_wrap(~DEM, scales = "fixed", ncol= 2)
```



## Site Level
Investigating metrics at the site level, while separating year and DEM scale resolution to investigate trends further.

Again, all sites sampled are included, even if only sampled in 2 of the 3 time points.

For all metrics, I have 3 plots: 1 that includes both DEM scales, and then 2 subsequent plots, 1 for each of the DEM scales.

### Surface Rugosity 

- In all sites, 2015-2017 shows decreases in SR

- In the majority of sites, 2017-2019  indicate increases in SR, with most not quite to the levels seen in 2015

- The sites that didn't experience this increase are:

- Site 30 - Rubble transport is highly dependent 

-Site 8 - I'm unsure what is causing this. When we look at individual plots, we will be able to see if any of those are driving this trend

```{r SR by site by DEM, echo=FALSE}
ggplot(mpq, aes(x = site, y=rug, fill = DEM)) +facet_wrap(~year, scales = "fixed", ncol= 3) + ggtitle("Both DEM scales") + geom_boxplot()+ theme_classic(base_size = 14) + xlab("Site") + ylab("Surface Rugosity")+ theme(plot.title = element_text(hjust = 0.5))+ theme(plot.title = element_text(size=22))

ggplot(mpq.1, aes(x = site, y=rug, fill = year)) + ggtitle("1cm DEM scale") + geom_boxplot()+ theme_classic(base_size = 14) + xlab("Site") + ylab("Surface Rugosity")+ theme(plot.title = element_text(hjust = 0.5))+ theme(plot.title = element_text(size=22))

ggplot(mpq.8, aes(x = site, y=rug, fill = year)) + ggtitle("8cm DEM scale") + geom_boxplot()+ theme_classic(base_size = 14) + xlab("Site") + ylab("Surface Rugosity")+ theme(plot.title = element_text(hjust = 0.5))+ theme(plot.title = element_text(size=22))

#ggplot(mpq.1, aes(x = Site, y=surface.rugosity, fill = Year)) + ggtitle("1cm DEM") + geom_boxplot()+ theme_classic(base_size = 14) + xlab("Site") + ylab("Surface Rugosity")+ theme(plot.title = element_text(hjust = 0.5))+ theme(plot.title = element_text(size=22))

#ggplot(mpq.8, aes(x = Site, y=surface.rugosity, fill = Year)) + ggtitle("8cm DEM") + geom_boxplot()+ theme_classic(base_size = 14) + xlab("Site") + ylab("Surface Rugosity")+ theme(plot.title = element_text(hjust = 0.5))+ theme(plot.title = element_text(size=22))

#Compare plots side by side
#grid.arrange(p1, p2, ncol=2)



```

### Terrain Ruggedness

- Similar trends here as seen in surface rugosity

- I really don't know what is causing 2019 values to be the same or even higher than 2015 values; its interesting though. The differences are more pronounced in the 1cm DEM resolution, but are still present in the 8cm scale too.

```{r TR by site, echo=FALSE}
ggplot(mpq, aes(x = site, y=vrm, fill = DEM)) +facet_wrap(~year, scales = "fixed", ncol= 3) + geom_boxplot()+ theme_classic(base_size = 14) + xlab("Site") + ylab("Terrain Ruggedness")+ theme(plot.title = element_text(hjust = 0.5))+ theme(plot.title = element_text(size=22))

ggplot(mpq.1, aes(x = site, y=vrm, fill = year)) + ggtitle("1cm DEM scale") + geom_boxplot()+ theme_classic(base_size = 14) + xlab("Site") + ylab("Terrain Ruggedness")+ theme(plot.title = element_text(hjust = 0.5))+ theme(plot.title = element_text(size=22))

ggplot(mpq.8, aes(x = site, y=vrm, fill = year)) + ggtitle("8cm DEM scale") + geom_boxplot()+ theme_classic(base_size = 14) + xlab("Site") + ylab("Terrain Ruggedness")+ theme(plot.title = element_text(hjust = 0.5))+ theme(plot.title = element_text(size=22))


```

### Slope

- Similar trends present as the previous 2 metrics

- I'm curious to see if it could be due to the structure being broken down into more "pieces" of rubble, thereby providing more surfaces with sharper surfaces, and therefore increased slopes? 

- That hypothesis wouldn't explain why 2015 values are mostly higher, but maybe sharper rubble doesn't make up for living, complex corals?

```{r Slope surf rug by site, echo=FALSE}
ggplot(mpq, aes(x = site, y=slope, fill = DEM)) +facet_wrap(~year, scales = "fixed", ncol= 3) + geom_boxplot()+ theme_classic(base_size = 14) + xlab("Site") + ylab("Slope")+ theme(plot.title = element_text(hjust = 0.5))+ theme(plot.title = element_text(size=22))


ggplot(mpq.1, aes(x = site, y=slope, fill = year)) + ggtitle("1cm DEM scale") + geom_boxplot()+ theme_classic(base_size = 14) + xlab("Site") + ylab("Slope")+ theme(plot.title = element_text(hjust = 0.5))+ theme(plot.title = element_text(size=22))

ggplot(mpq.8, aes(x = site, y=slope, fill = year)) + ggtitle("8cm DEM scale") + geom_boxplot()+ theme_classic(base_size = 14) + xlab("Site") + ylab("Slope")+ theme(plot.title = element_text(hjust = 0.5))+ theme(plot.title = element_text(size=22))

```

### Profile Curvature

- This illustrates how profile curvature values are highest in 2019 almost across the board, and that 2015 exhibited some of the more negative values, especially at the VH disturbance sites

- As mentioned before, this describes how the surface of the structure is changing from outwardly convex to more inwardly concave structure, which I hypothesize is due to erosion

```{r ProCurv surf rug by site, echo=FALSE}
ggplot(mpq, aes(x = site, y=pro.curv, fill = DEM)) +facet_wrap(~year, scales = "fixed", ncol= 3) + ggtitle("Both DEM scales") + geom_boxplot()+ theme_classic(base_size = 14) + xlab("Site") + ylab("Profile Curvature")+ theme(plot.title = element_text(hjust = 0.5))+ theme(plot.title = element_text(size=22))

ggplot(mpq.1, aes(x = site, y=pro.curv, fill = year)) + ggtitle("1cm DEM scale") + geom_boxplot()+ theme_classic(base_size = 14) + xlab("Site") + ylab("Profile Curvature")+ theme(plot.title = element_text(hjust = 0.5))+ theme(plot.title = element_text(size=22))

ggplot(mpq.8, aes(x = site, y=pro.curv, fill = year)) + ggtitle("8cm DEM scale") + geom_boxplot()+ theme_classic(base_size = 14) + xlab("Site") + ylab("Profile Curvature")+ theme(plot.title = element_text(hjust = 0.5))+ theme(plot.title = element_text(size=22))


```

### Planform Curvature

- Similar trends present to those seen with profile curvature

- The overall shape of the structure has transformed from more negative (concave) to more positive (convex) values, however these changes are perpendicular to the maximum slope of the surface. 


```{r PlanCurv surf rug by site, echo=FALSE}
ggplot(mpq, aes(x = site, y=plan.curv, fill = DEM)) +facet_wrap(~year, scales = "fixed", ncol= 3) + ggtitle("Both DEM scales") + geom_boxplot()+ theme_classic(base_size = 14) + xlab("Site") + ylab("Planform Curvature")+ theme(plot.title = element_text(hjust = 0.5))+ theme(plot.title = element_text(size=22))

ggplot(mpq.1, aes(x = site, y=plan.curv, fill = year)) + ggtitle("1cm DEM scale") + geom_boxplot()+ theme_classic(base_size = 14) + xlab("Site") + ylab("Planform Curvature")+ theme(plot.title = element_text(hjust = 0.5))+ theme(plot.title = element_text(size=22))

ggplot(mpq.8, aes(x = site, y=plan.curv, fill = year)) + ggtitle("8cm DEM scale") + geom_boxplot()+ theme_classic(base_size = 14) + xlab("Site") + ylab("Planform Curvature")+ theme(plot.title = element_text(hjust = 0.5))+ theme(plot.title = element_text(size=22))


```


## Plot Level
Finally, I examined down the changes at each plot through time and by DEM scale. These sites are clustered  together based on their human disturbance level (VH --> M --> VL). 

### Surface Rugosity 

- All the plots at site 27, 32 exhibit the same trend at 1cm DEM, where 2019 SR is higher than any other year; I believe this is due to the fact that the rubble transport is so variable by year that its just luck of the draw what ends up in the plot area

- I looked at Site 34 MPQ 3 at the three time points, and have a new hypothesis: The large macro algae bloom seen in 2017 made the coral features (now mostly dead), less pronounced from the seafloor, and therefore less complex. I'm not sure why that is being picked up at the DEM scale of 8cm however....

- VL sites all had complexity values return to pre-mortality event mostly, or at least very close. 2017 was by far the lowest valued year for all the plots.


```{r SR by plot, echo=FALSE}
ggplot(mpq.1, aes(ppq, rug, colour = year)) + geom_boxplot() +facet_wrap(~site, scales = "fixed", ncol= 3) + xlab("PPQ") + ylab("Surface Rugosity")+ theme(plot.title = element_text(hjust = 0.5))+ theme(plot.title = element_text(size=22)) + ggtitle("1cm DEM")

ggplot(mpq.8, aes(ppq, rug, colour = year)) + geom_boxplot() +facet_wrap(~site, scales = "fixed", ncol= 3) + xlab("PPQ") + ylab("Surface Rugosity")+ theme(plot.title = element_text(hjust = 0.5))+ theme(plot.title = element_text(size=22)) + ggtitle("8cm DEM")

#Compare plots side by side
#grid.arrange(p1, p2, ncol=2)

```

### Terrain Ruggedness

- Similar trends to what were seen with SR; refer to there for hypotheses/description

```{r TR by plot, echo=FALSE}
ggplot(mpq.1, aes(ppq, vrm, colour = year)) + geom_boxplot() +facet_wrap(~site, scales = "fixed", ncol= 3) + xlab("PPQ") + ylab("Terrain Ruggedness")+ theme(plot.title = element_text(hjust = 0.5))+ theme(plot.title = element_text(size=22)) + ggtitle("1cm DEM")

ggplot(mpq.8, aes(ppq, vrm, colour = year)) + geom_boxplot() +facet_wrap(~site, scales = "fixed", ncol= 3) + xlab("PPQ") + ylab("Terrain Ruggedness")+ theme(plot.title = element_text(hjust = 0.5))+ theme(plot.title = element_text(size=22)) + ggtitle("8cm DEM")


```

### Slope

- Again, very similar trends to SR and VRM; refer to those sections for hypotheses

```{r Slope by plot, echo=FALSE}
ggplot(mpq.1, aes(ppq, slope, colour = year)) + geom_boxplot() +facet_wrap(~site, scales = "fixed", ncol= 3) + xlab("PPQ") + ylab("Slope")+ theme(plot.title = element_text(hjust = 0.5))+ theme(plot.title = element_text(size=22)) + ggtitle("1cm DEM")

ggplot(mpq.8, aes(ppq, slope, colour = year)) + geom_boxplot() +facet_wrap(~site, scales = "fixed", ncol= 3) + xlab("PPQ") + ylab("Slope")+ theme(plot.title = element_text(hjust = 0.5))+ theme(plot.title = element_text(size=22)) + ggtitle("8cm DEM")

```

### Profile Curvature

- A shift towards more positive values is clear throughout the years, although appears most pronounced in the VL sites

- By eyeballing it, the magnitude of the shift  in curvature values throughout time is highest in VL > VH > M

- As previously stated, I believe this is due to erosion occurring on the structure surfaces, causing the outward projection to become more concave.

```{r ProCurv by plot, echo=FALSE}
ggplot(mpq.1, aes(ppq, pro.curv, colour = year)) + geom_boxplot() +facet_wrap(~site, scales = "fixed", ncol= 3) + xlab("PPQ") + ylab("Profile Curvature")+ theme(plot.title = element_text(hjust = 0.5))+ theme(plot.title = element_text(size=22)) + ggtitle("1cm DEM")

ggplot(mpq.8, aes(ppq, pro.curv, colour = year)) + geom_boxplot() +facet_wrap(~site, scales = "fixed", ncol= 3) + xlab("PPQ") + ylab("Profile Curvature")+ theme(plot.title = element_text(hjust = 0.5))+ theme(plot.title = element_text(size=22)) + ggtitle("8cm DEM")


```


### Planform Curvature

- Similar trends to that of Profile Curvature; refer to there for hypotheses

```{r PlanCurv surf by plot, echo=FALSE}
ggplot(mpq.1, aes(ppq, plan.curv, colour = year)) + geom_boxplot() +facet_wrap(~site, scales = "fixed", ncol= 3) + xlab("PPQ") + ylab("Planform Curvature")+ theme(plot.title = element_text(hjust = 0.5))+ theme(plot.title = element_text(size=22)) + ggtitle("1cm DEM")

ggplot(mpq.8, aes(ppq, plan.curv, colour = year)) + geom_boxplot() +facet_wrap(~site, scales = "fixed", ncol= 3) + xlab("PPQ") + ylab("Planform Curvature")+ theme(plot.title = element_text(hjust = 0.5))+ theme(plot.title = element_text(size=22)) + ggtitle("8cm DEM")


```

