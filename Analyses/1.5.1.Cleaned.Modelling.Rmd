---
title: "1.5.1 Cleaned.Modelling"
author: "Kevin Bruce"
date: "15/01/2021"
output: html_document
---

#Load Packages/Data
```{r Load the packages and load mpq data, include=FALSE}
rm(list = ls()) #This clears the environment
dev.off()

library(dplyr)
library(ggplot2)
library(stats)
library(Rmisc)
library(here)
library(ggpmisc)
library(knitr)
library(magick)
library(gridExtra)
library(car)
library(tidyr)
library(readxl)
library(vegan)
library(tidyverse)
library(ade4)
library(MASS)
library(ellipse)
library(FactoMineR)
library(arm)
library(ape)
library(ggrepel)
library(FactoMineR)
library(ggpubr)
library(corrplot)
library(Matrix)
library(lme4)
library(TMB)
library(glmmTMB)
library(MuMIn)
library(vegan)
library(nlme)
library(randomForest)
library(qpcR)
library(emmeans)
library(sjPlot)
library(lmtest) #Durbin-Watson Test

# <---------------------------- DATA -------------------------->
#ArcMap Complexity/Curvature Data
mpq.1cm <- read.csv("~/Desktop/GitHub/Bruce_MPQ_Analysis/Data/BaumLab_Complexity_FULL_1cm_Data_14Jan21.csv", row.names=1)

mpq.4cm <- read.csv("~/Desktop/GitHub/Bruce_MPQ_Analysis/Data/BaumLab_Complexity_FULL_4cm_Data_22Jan21.csv")

mpq.8cm <- read.csv("~/Desktop/GitHub/Bruce_MPQ_Analysis/Data/BaumLab_Complexity_FULL_8cm_Data_22Jan21.csv")


#Digitization + Complexity Dataframes (3years, 2015, 2017, 2019)
mpq.dig.semi.1cm <- read.csv("~/Desktop/GitHub/Bruce_MPQ_Analysis/Data/BaumLab_Complex+Digitization_SEMI_1cm_Data_11Jan21.csv")


mpq.dig.jm.1cm <-read.csv("~/Desktop/GitHub/Bruce_MPQ_Analysis/Data/BaumLab_Complex+Digitization_JM.Classificaition_1cm_Data_11Jan21.csv")





#Habitat Volume Data
CC.final <- read.csv("~/Desktop/GitHub/Bruce_MPQ_Analysis/Data/BaumLab_CloudCompare_Data_FINAL_14Jan2021.csv", row.names = 1)

#Subset out the overall changes in data (2015-2019 datapoints)
cc <- subset(CC.final, timepoint == "2015-2017" | timepoint == "2017-2019")

#Level time interval
cc$time.interval <- factor(cc$time.interval, levels = c("'15-'17","'17-'19"))

cc.2tps <- subset(cc, timepoint == "2015-2017" | timepoint == "2017-2019")


#<----------------------- Random Forest Data ------------------------->
#Detailed Morphological Categorization
mpq.dig.semi.1cm<- read.csv("~/Desktop/GitHub/Bruce_MPQ_Analysis/Data/BaumLab_Complex+Digitization_SEMI_1cm_Data_11Jan21.csv", row.names = 1)

#Simplified Morphological Categorization
mpq.dig.simple.1cm<- read.csv("~/Desktop/GitHub/Bruce_MPQ_Analysis/Data/BaumLab_Complex+Digitization_SIMPLE_1cm_Data_11Jan21.csv", row.names = 1)

#JM's Classification
mpq.dig.jm.1cm <- read.csv("~/Desktop/GitHub/Bruce_MPQ_Analysis/Data/BaumLab_Complex+Digitization_JM.Classificaition_1cm_Data_11Jan21.csv", row.names = 1)

#Create Dataframes of all options, then just coral morphologys (no abiotic sand/rubble)
vrm.per.1cm.semi <- mpq.dig.semi.1cm[c(12,20:41)] #1cm semi df, all colonies
vrm.per.1cm.semi.live <- mpq.dig.semi.1cm[c(12,26:35,37,40:41)] #no abiotic str or macroalgae
vrm.per.1cm.jm <- mpq.dig.jm.1cm[c(12,20:24)] #All colonies
vrm.per.1cm.jm.live <- mpq.dig.jm.1cm[c(12,21,23:24)] #Only live coral colonies (No abiotic + Macroalgae)

#Surface Complexity
rug.per.1cm.semi <- mpq.dig.semi.1cm[c(11,20:41)] #1cm semi df, all
rug.per.1cm.semi.live <- mpq.dig.semi.1cm[c(11,26:35,37,40:41)] #no abiotic str or macroalgae
rug.per.1cm.jm<- mpq.dig.jm.1cm[c(11,20:24)] #entire simple dataframe
rug.per.1cm.jm.live <- mpq.dig.jm.1cm[c(11,21,23:24)]

#Fractal Dimension
fractal.dimension.per.1cm.semi <- mpq.dig.semi.1cm[c(19,20:41)] #1cm semi df, all
fractal.dimension.per.1cm.semi.live <- mpq.dig.semi.1cm[c(19,26:35,37,40:41)] #no abiotic str or macroalgae
fractal.dimension.per.1cm.jm <- mpq.dig.jm.1cm[c(19,20:24)] #entire simple dataframe
fractal.dimension.per.1cm.jm.live <- mpq.dig.jm.1cm[c(19,21,23:24)] #Only live coral colonies (No abiotic + Macroalgae)

#Profile Curvature
pro.per.1cm.semi <- mpq.dig.semi.1cm[c(16,20:41)] #1cm semi df, all
pro.per.1cm.semi.live <- mpq.dig.semi.1cm[c(16,26:35,37,40:41)] #no abiotic str
pro.per.1cm.jm <- mpq.dig.jm.1cm[c(16,20:24)] #entire simple dataframe
pro.per.1cm.jm.live <- mpq.dig.jm.1cm[c(16,21,23:24)] #entire simple dataframe

#Planform Curvature
plan.per.1cm.semi <- mpq.dig.semi.1cm[c(18,20:41)] #1cm semi df, all
plan.per.1cm.semi.live <- mpq.dig.semi.1cm[c(18,26:35,37,40:41)] #no abiotic str
plan.per.1cm.jm <- mpq.dig.jm.1cm[c(18,20:24)] #entire simple dataframe
plan.per.1cm.jm.live <- mpq.dig.jm.1cm[c(18,21,23:24)] #entire simple dataframe



```


# Simplified, Clean Models from help with DOM
```{r testing to see if island side vs region3 should be used}
#Incorporating Island Side
global.vrma <- lmer(vrm~ year * sqrt.hdist.cont + region.3 + (1|site), data = mpq.1cm)
global.vrmb <- lmer(vrm~ year * sqrt.hdist.cont + island.side + (1|site), data = mpq.1cm)


vrm1 <- lm(vrm ~ year, data = mpq.1cm) 
vrm2 <- lm(vrm ~ year + sqrt.hdist.cont, data = mpq.1cm)
vrm3 <- lm(vrm ~ year * sqrt.hdist.cont, data = mpq.1cm)
vrm4 <- lm(vrm ~ sqrt.hdist.cont, data = mpq.1cm)

vrm5 <- lm(vrm ~ year + sqrt.hdist.cont + region.3, data = mpq.1cm) 
vrm6 <- lm(vrm ~ year * sqrt.hdist.cont + region.3, data = mpq.1cm)
vrm7 <- lm(vrm~ year + region.3, data = mpq.1cm)

vrm8 <- lmer(vrm ~ year + sqrt.hdist.cont + region.3 + (1|site), data = mpq.1cm)
vrm9 <- lmer(vrm ~ year * sqrt.hdist.cont + region.3 + (1|site), data = mpq.1cm)
vrm10 <- lmer(vrm ~ year + sqrt.hdist.cont + (1|site), data = mpq.1cm)
vrm11 <- lmer(vrm ~ year * sqrt.hdist.cont + (1|site), data = mpq.1cm)
vrm12 <- lmer(vrm ~ year + (1|site), data = mpq.1cm)
vrm13 <- lmer(vrm ~ year + (1|site), data = mpq.1cm)


vrm14 <- lm(vrm ~ year + sqrt.hdist.cont + island.side, data = mpq.1cm) 
vrm15 <- lm(vrm ~ year * sqrt.hdist.cont + island.side, data = mpq.1cm)
vrm16 <- lm(vrm~ year + island.side, data = mpq.1cm)
vrm17 <- lmer(vrm ~ year + sqrt.hdist.cont + island.side + (1|site), data = mpq.1cm)
vrm18 <- lmer(vrm ~ year * sqrt.hdist.cont + island.side + (1|site), data = mpq.1cm)


## AIC model selection
AIC_vrm.table <- model.sel(vrm1,vrm2,vrm3,vrm4,vrm5,vrm6,vrm7,vrm8,vrm9,vrm10,vrm11,vrm12, vrm13, vrm14, vrm15, vrm16, vrm17, vrm18, global.vrma, global.vrmb)

# ## AIC summary table 
# names(AIC_vrm.table) <- c("(Int)", "Year", "Human Disturbance", "Disturbance*Year", "Region", "Family", "Model.Class","df", "LL", "AICc", "∆AICc", "weight")
# AIC_vrm.table$weight <- c(akaike.weights(AIC_vrm.table$AICc)$weights)
# 
# summary(vrm6)
# 
# <- ---------
global.ruga <- lmer(rug ~ year * sqrt.hdist.cont + region.3 + (1|site), data = mpq.1cm)
global.rugb <- lmer(rug ~ year * sqrt.hdist.cont + island.side + (1|site), data = mpq.1cm)


rug1 <- lm(rug ~ year, data = mpq.1cm) 
rug2 <- lm(rug ~ year + sqrt.hdist.cont, data = mpq.1cm)
rug3 <- lm(rug ~ year * sqrt.hdist.cont, data = mpq.1cm)
rug4 <- lm(rug ~ sqrt.hdist.cont, data = mpq.1cm)

rug5 <- lm(rug ~ year + sqrt.hdist.cont + region.3, data = mpq.1cm) 
rug6 <- lm(rug ~ year * sqrt.hdist.cont + region.3, data = mpq.1cm)
rug7 <- lm(rug~ year + region.3, data = mpq.1cm)

rug8 <- lmer(rug ~ year + sqrt.hdist.cont + region.3 + (1|site), data = mpq.1cm)
rug9 <- lmer(rug ~ year * sqrt.hdist.cont + region.3 + (1|site), data = mpq.1cm)
rug10 <- lmer(rug ~ year + sqrt.hdist.cont + (1|site), data = mpq.1cm)
rug11 <- lmer(rug ~ year * sqrt.hdist.cont + (1|site), data = mpq.1cm)
rug12 <- lmer(rug ~ year + (1|site), data = mpq.1cm)
rug13 <- lmer(rug ~ year + (1|site), data = mpq.1cm)


rug14 <- lm(rug ~ year + sqrt.hdist.cont + island.side, data = mpq.1cm) 
rug15 <- lm(rug ~ year * sqrt.hdist.cont + island.side, data = mpq.1cm)
rug16 <- lm(rug~ year + island.side, data = mpq.1cm)
rug17 <- lmer(rug ~ year + sqrt.hdist.cont + island.side + (1|site), data = mpq.1cm)
rug18 <- lmer(rug ~ year * sqrt.hdist.cont + island.side + (1|site), data = mpq.1cm)


## AIC model selection
AIC_rug.table <- model.sel(rug1,rug2,rug3,rug4,rug5,rug6,rug7,rug8,rug9,rug10,rug11,rug12, rug13, rug14, rug15, rug16, rug17, rug18, global.ruga, global.rugb)

#<---------------
global.fraca <- lmer(fractal.dimension ~ year * sqrt.hdist.cont + region.3 + (1|site), data = mpq.1cm)
global.fracb <- lmer(fractal.dimension ~ year * sqrt.hdist.cont + island.side + (1|site), data = mpq.1cm)


frac1 <- lm(fractal.dimension ~ year, data = mpq.1cm) 
frac2 <- lm(fractal.dimension ~ year + sqrt.hdist.cont, data = mpq.1cm)
frac3 <- lm(fractal.dimension ~ year * sqrt.hdist.cont, data = mpq.1cm)
frac4 <- lm(fractal.dimension ~ sqrt.hdist.cont, data = mpq.1cm)

frac5 <- lm(fractal.dimension ~ year + sqrt.hdist.cont + region.3, data = mpq.1cm) 
frac6 <- lm(fractal.dimension ~ year * sqrt.hdist.cont + region.3, data = mpq.1cm)
frac7 <- lm(fractal.dimension~ year + region.3, data = mpq.1cm)

frac8 <- lmer(fractal.dimension ~ year + sqrt.hdist.cont + region.3 + (1|site), data = mpq.1cm)
frac9 <- lmer(fractal.dimension ~ year * sqrt.hdist.cont + region.3 + (1|site), data = mpq.1cm)
frac10 <- lmer(fractal.dimension ~ year + sqrt.hdist.cont + (1|site), data = mpq.1cm)
frac11 <- lmer(fractal.dimension ~ year * sqrt.hdist.cont + (1|site), data = mpq.1cm)
frac12 <- lmer(fractal.dimension ~ year + (1|site), data = mpq.1cm)
frac13 <- lmer(fractal.dimension ~ year + (1|site), data = mpq.1cm)


frac14 <- lm(fractal.dimension ~ year + sqrt.hdist.cont + island.side, data = mpq.1cm) 
frac15 <- lm(fractal.dimension ~ year * sqrt.hdist.cont + island.side, data = mpq.1cm)
frac16 <- lm(fractal.dimension~ year + island.side, data = mpq.1cm)
frac17 <- lmer(fractal.dimension ~ year + sqrt.hdist.cont + island.side + (1|site), data = mpq.1cm)
frac18 <- lmer(fractal.dimension ~ year * sqrt.hdist.cont + island.side + (1|site), data = mpq.1cm)


## AIC model selection
AIC_frac.table <- model.sel(frac1,frac2,frac3,frac4,frac5,frac6,frac7,frac8,frac9,frac10,frac11,frac12, frac13, frac14, frac15, frac16, frac17, frac18, global.fraca, global.fracb)

# <- ---------
global.pro.rangea <- lmer(pro.range.log ~ year * sqrt.hdist.cont + region.3 + (1|site), data = mpq.1cm)
global.pro.rangeb <- lmer(pro.range.log ~ year * sqrt.hdist.cont + island.side + (1|site), data = mpq.1cm)


pro.range1 <- lm(pro.range.log ~ year, data = mpq.1cm) 
pro.range2 <- lm(pro.range.log ~ year + sqrt.hdist.cont, data = mpq.1cm)
pro.range3 <- lm(pro.range.log ~ year * sqrt.hdist.cont, data = mpq.1cm)
pro.range4 <- lm(pro.range.log ~ sqrt.hdist.cont, data = mpq.1cm)

pro.range5 <- lm(pro.range.log ~ year + sqrt.hdist.cont + region.3, data = mpq.1cm) 
pro.range6 <- lm(pro.range.log ~ year * sqrt.hdist.cont + region.3, data = mpq.1cm)
pro.range7 <- lm(pro.range.log~ year + region.3, data = mpq.1cm)

pro.range8 <- lmer(pro.range.log ~ year + sqrt.hdist.cont + region.3 + (1|site), data = mpq.1cm)
pro.range9 <- lmer(pro.range.log ~ year * sqrt.hdist.cont + region.3 + (1|site), data = mpq.1cm)
pro.range10 <- lmer(pro.range.log ~ year + sqrt.hdist.cont + (1|site), data = mpq.1cm)
pro.range11 <- lmer(pro.range.log ~ year * sqrt.hdist.cont + (1|site), data = mpq.1cm)
pro.range12 <- lmer(pro.range.log ~ year + (1|site), data = mpq.1cm)
pro.range13 <- lmer(pro.range.log ~ year + (1|site), data = mpq.1cm)


pro.range14 <- lm(pro.range.log ~ year + sqrt.hdist.cont + island.side, data = mpq.1cm) 
pro.range15 <- lm(pro.range.log ~ year * sqrt.hdist.cont + island.side, data = mpq.1cm)
pro.range16 <- lm(pro.range.log~ year + island.side, data = mpq.1cm)
pro.range17 <- lmer(pro.range.log ~ year + sqrt.hdist.cont + island.side + (1|site), data = mpq.1cm)
pro.range18 <- lmer(pro.range.log ~ year * sqrt.hdist.cont + island.side + (1|site), data = mpq.1cm)


## AIC model selection
AIC_pro.range.table <- model.sel(pro.range1,pro.range2,pro.range3,pro.range4,pro.range5,pro.range6,pro.range7,pro.range8,pro.range9,pro.range10,pro.range11,pro.range12, pro.range13, pro.range14, pro.range15, pro.range16, pro.range17, pro.range18, global.pro.rangea, global.pro.rangeb)




# <- ---------
global.plan.rangea <- lmer(plan.range.log ~ year * sqrt.hdist.cont + region.3 + (1|site), data = mpq.1cm)
global.plan.rangeb <- lmer(plan.range.log ~ year * sqrt.hdist.cont + island.side + (1|site), data = mpq.1cm)


plan.range1 <- lm(plan.range.log ~ year, data = mpq.1cm) 
plan.range2 <- lm(plan.range.log ~ year + sqrt.hdist.cont, data = mpq.1cm)
plan.range3 <- lm(plan.range.log ~ year * sqrt.hdist.cont, data = mpq.1cm)
plan.range4 <- lm(plan.range.log ~ sqrt.hdist.cont, data = mpq.1cm)

plan.range5 <- lm(plan.range.log ~ year + sqrt.hdist.cont + region.3, data = mpq.1cm) 
plan.range6 <- lm(plan.range.log ~ year * sqrt.hdist.cont + region.3, data = mpq.1cm)
plan.range7 <- lm(plan.range.log~ year + region.3, data = mpq.1cm)

plan.range8 <- lmer(plan.range.log ~ year + sqrt.hdist.cont + region.3 + (1|site), data = mpq.1cm)
plan.range9 <- lmer(plan.range.log ~ year * sqrt.hdist.cont + region.3 + (1|site), data = mpq.1cm)
plan.range10 <- lmer(plan.range.log ~ year + sqrt.hdist.cont + (1|site), data = mpq.1cm)
plan.range11 <- lmer(plan.range.log ~ year * sqrt.hdist.cont + (1|site), data = mpq.1cm)
plan.range12 <- lmer(plan.range.log ~ year + (1|site), data = mpq.1cm)
plan.range13 <- lmer(plan.range.log ~ year + (1|site), data = mpq.1cm)


plan.range14 <- lm(plan.range.log ~ year + sqrt.hdist.cont + island.side, data = mpq.1cm) 
plan.range15 <- lm(plan.range.log ~ year * sqrt.hdist.cont + island.side, data = mpq.1cm)
plan.range16 <- lm(plan.range.log~ year + island.side, data = mpq.1cm)
plan.range17 <- lmer(plan.range.log ~ year + sqrt.hdist.cont + island.side + (1|site), data = mpq.1cm)
plan.range18 <- lmer(plan.range.log ~ year * sqrt.hdist.cont + island.side + (1|site), data = mpq.1cm)


## AIC model selection
AIC_plan.range.table <- model.sel(plan.range1,plan.range2,plan.range3,plan.range4,plan.range5,plan.range6,plan.range7,plan.range8,plan.range9,plan.range10,plan.range11,plan.range12, plan.range13, plan.range14, plan.range15, plan.range16, plan.range17, plan.range18, global.plan.rangea, global.plan.rangeb)
```

Take Home Message:  **USE ISLAND.SIDE OVER REGION.3**

## Exploring simple linear regressions to ensure I understand the outputs
```{r understanding the linear regressions better}
mpq.1cm

#Subset so that only 2 years exist
mpq.2yrs <- subset(mpq.1cm, year == "2015" | year == "2016a")

#Run top model for vrm
vrm.2yr.simple <- lm(vrm ~ sqrt.hdist.cont, data = mpq.2yrs)
summary(vrm.2yr.simple)

#Calculate slope
emtrends(vrm.2yr.simple, ~ 1, var = "sqrt.hdist.cont" )

#Repeat steps
vrm.2yr.2 <- lm(vrm ~ year +sqrt.hdist.cont, data = mpq.2yrs)
summary(vrm.2yr.2)
emtrends(vrm.2yr.2, ~ 1, var = "sqrt.hdist.cont" )

#Slope of human dist is the same as when it was the sole variable in the model
#Slope of year is -0.0218294
vrm.2yr.3 <- lm(vrm ~ year, data = mpq.2yrs)
summary(vrm.2yr.3)
emtrends(vrm.2yr.3, ~ 1, var = "sqrt.hdist.cont" )



#Continuous vs categorical variable with interaction
vrm.2yr <- lm(vrm ~ year * sqrt.hdist.cont, data = mpq.2yrs)
summary(vrm.2yr)
emtrends(vrm.2yr, ~ year, var="sqrt.hdist.cont")

emtrends(vrm.2yr, pairwise ~ year, var="sqrt.hdist.cont") #Tests the differences in the slopes
#So from 2015 - 2016a, the slope of the line decreased by 0.000223 units







#Run top model for vrm
vrm.a <- lm(vrm ~ sqrt.hdist.cont, data = mpq.1cm)
summary(vrm.a)

#Calculate slope
emtrends(vrm.a, ~ 1, var = "sqrt.hdist.cont" )

#Repeat steps
vrm.a2 <- lm(vrm ~ year*sqrt.hdist.cont, data = mpq.1cm)
summary(vrm.a2)
emtrends(vrm.a2, ~ 1, var = "sqrt.hdist.cont" )

emtrends(vrm.a2, pairwise ~ year, var="sqrt.hdist.cont") #Tests the differences in the slopes

#Summary:
# -Slopes are all negative, however the steepest slope (IE: differentiation bewteen disturbance levels) occured at 2015 and the lowest differentiation was in 2019.The slopes between 2015 and 2017/2019 were significantly different from one another. 


#Try for full model:
summary(vrm6)
emtrends(vrm6, pairwise ~ year, var="sqrt.hdist.cont") #Tests the differences in the slopes

#All values are negative, with the largest negative slope occurring in 2015, lowest slope value is in 2017. 2019 there is a slight uptick in slope, indicating that the differences between levels of disturbance is getting more pronounced again.


#You get these values by taking the baseline's slope (IE: the estimate for sqrt.hdist.cont = 2015 (baseline) slope) and adding the estimate of the interaction term you are looking to find the slope for. Ex: 2016a: -0.000369 + 0.0001318 = -0.0002372 (which is what we are told it is in the emtrends code output!)

```

## VRM
```{r vrm simplfied models}
# #Available model variables:
# sqrt.hdist.cont #Square Root Transformed Human Disturbance
# year #Expedition Year
# island.side #2 coarse regions of island side
# site #site (as random effect)

#First, compute min and max values of metric to denote range of values
min(mpq.1cm$vrm) #0.02109
max(mpq.1cm$vrm) #0.11092

#Models
global.vrm <- lmer(vrm~ year * sqrt.hdist.cont + island.side + (1|site), data = mpq.1cm)

vrm1 <- lm(vrm ~ year, data = mpq.1cm) 
vrm2 <- lm(vrm ~ year + sqrt.hdist.cont, data = mpq.1cm)
vrm3 <- lm(vrm ~ year * sqrt.hdist.cont, data = mpq.1cm)
vrm4 <- lm(vrm ~ sqrt.hdist.cont, data = mpq.1cm)

vrm5 <- lm(vrm ~ year + sqrt.hdist.cont + island.side, data = mpq.1cm) 
vrm6 <- lm(vrm ~ year * sqrt.hdist.cont + island.side, data = mpq.1cm)
vrm7 <- lm(vrm~ year + island.side, data = mpq.1cm)

vrm8 <- lmer(vrm ~ year + sqrt.hdist.cont + island.side + (1|site), data = mpq.1cm)
vrm9 <- lmer(vrm ~ year * sqrt.hdist.cont + island.side + (1|site), data = mpq.1cm)
vrm10 <- lmer(vrm ~ year + sqrt.hdist.cont + (1|site), data = mpq.1cm)
vrm11 <- lmer(vrm ~ year * sqrt.hdist.cont + (1|site), data = mpq.1cm)
vrm12 <- lmer(vrm ~ year + (1|site), data = mpq.1cm)
vrm13 <- lmer(vrm ~ year + (1|site), data = mpq.1cm)

## AIC model selection
AIC_vrm.table <- model.sel(vrm1,vrm2,vrm3,vrm4,vrm5,vrm6,vrm7,vrm8,vrm9,vrm10,vrm11,vrm12, vrm13, global.vrm)

## AIC summary table 
names(AIC_vrm.table) <- c("(Int)", "Year", "Human Disturbance", "Disturbance*Year", "Island.Side", "Family", "Model.Class","df", "LL", "AICc", "∆AICc", "weight")
AIC_vrm.table$weight <- c(akaike.weights(AIC_vrm.table$AICc)$weights)

#Top Models within 4AIC
summary(vrm6)
summary(vrm5)

#Check out slopes of interaction
summary(vrm6)
emtrends(vrm6, pairwise ~ year, var="sqrt.hdist.cont") #Tests the differences in the slopes



#See if leeward vs windward is significant and which side was higher
anova(vrm6)
vrm.emm.island <- emmeans(vrm6, "island.side")
pairs(vrm.emm.island) 


#See which years are significantly different from one another of the raw data using the top model without interaction
summary(vrm5)
vrm.emm.year <- emmeans(vrm5, "year")
pairs(vrm.emm.year) 








### TEST TO SEE IF STICKING WITH THE INTERACTION IS BEST
# Original model
vrm6 <- lm(vrm ~ year * sqrt.hdist.cont + island.side, data = mpq.1cm)

# Model without an interaction
vrm6.i <- lm(vrm ~ year + sqrt.hdist.cont + island.side, data = mpq.1cm)

# Likelihood ratio test
anova(vrm6, vrm6.i, test="LRT") #Best to keep the interaction term. 

ggplot(mpq.1cm, aes(x=island.side, y=vrm)) + geom_boxplot()



# #Check top model set variance homogeneity
# par(mfrow=c(2,2))
# plot(vrm6)
# plot(vrm5)



#Durbin-Watson Test for autocorrelation
# vrm6 #Top model
vrm.dw <- dwtest(vrm6, order.by = NULL,alternative = c("greater", "two.sided", "less"),
       iterations = 15, exact = NULL, data = list())
vrm.dw

#Breusch-Godfrey Test (Null = there is no serial correlation of any order up to p.)
bgtest(vrm ~ year * sqrt.hdist.cont + island.side, data = mpq.1cm, order=1) #P=0.9391

```

## Surface Complexity
```{r rug simplfied models}
# #Available model variables:
# sqrt.hdist.cont #Square Root Transformed Human Disturbance
# year #Expedition Year
# island.side #2 coarse regions of island side
# site #site (as random effect)

#Data
mpq.1cm 


#Models
global.rug <- lmer(rug~ year * sqrt.hdist.cont + island.side + (1|site), data = mpq.1cm)

rug1 <- lm(rug ~ year, data = mpq.1cm) 
rug2 <- lm(rug ~ year + sqrt.hdist.cont, data = mpq.1cm)
rug3 <- lm(rug ~ year * sqrt.hdist.cont, data = mpq.1cm)
rug4 <- lm(rug ~ sqrt.hdist.cont, data = mpq.1cm)

rug5 <- lm(rug ~ year + sqrt.hdist.cont + island.side, data = mpq.1cm) 
rug6 <- lm(rug ~ year * sqrt.hdist.cont + island.side, data = mpq.1cm)
rug7 <- lm(rug~ year + island.side, data = mpq.1cm)

rug8 <- lmer(rug ~ year + sqrt.hdist.cont + island.side + (1|site), data = mpq.1cm)
rug9 <- lmer(rug ~ year * sqrt.hdist.cont + island.side + (1|site), data = mpq.1cm)
rug10 <- lmer(rug ~ year + sqrt.hdist.cont + (1|site), data = mpq.1cm)
rug11 <- lmer(rug ~ year * sqrt.hdist.cont + (1|site), data = mpq.1cm)
rug12 <- lmer(rug ~ year + (1|site), data = mpq.1cm)
rug13 <- lmer(rug ~ year + (1|site), data = mpq.1cm)

## AIC model selection
AIC_rug.table <- model.sel(rug1,rug2,rug3,rug4,rug5,rug6,rug7,rug8,rug9,rug10,rug11,rug12, rug13, global.rug)

## AIC summary table 
names(AIC_rug.table) <- c("(Int)", "Year", "Human Disturbance", "Disturbance*Year", "Island.Side", "Family", "Model.Class","df", "LL", "AICc", "∆AICc", "weight")
AIC_rug.table$weight <- c(akaike.weights(AIC_rug.table$AICc)$weights)

#Top Models within 4AIC
summary(rug5)
summary(rug6)

#There is no interaction, so therefore the slopes of the lines are the same
rug.predicted <- plot_model(rug5, type = "pred", terms = c("sqrt.hdist.cont", "year"))

#See which years are significantly different from one another
summary(rug5)
rug.emm.s <- emmeans(rug5, "year")
pairs(rug.emm.s) 


#See if leeward vs windward is significant and which side was higher
anova(rug5)
rug.emm.island <- emmeans(rug5, "island.side")
pairs(rug.emm.island) 

ggplot(mpq.1cm, aes(x=island.side, y=rug)) + geom_boxplot()


#Summary: 2015 sig different than all years but 2019. 2017 and 2019 are not signifantly different, but recall 2017 is different from 2015. 

# ggplot(mpq.1cm, aes(x=year, y=rug)) + geom_boxplot()

#VL sites are higher than sites of VH dist
# ggplot(mpq.1cm, aes(x=year, y=rug, fill=hum_dist)) + geom_boxplot()


#Check top model set variance homogeneity
par(mfrow=c(2,2))
plot(rug5)

#Durbin-Watson Test for autocorrelation
# rug5 #Top model
rug.dw <- dwtest(rug5, order.by = NULL,alternative = c("greater", "two.sided", "less"),
       iterations = 15, exact = NULL, data = list())
rug.dw

#Breusch-Godfrey Test (Null = there is no serial correlation of any order up to p.)
bgtest(rug ~ year + sqrt.hdist.cont + island.side, data = mpq.1cm, order=1) #P=0.8985




```

## Fractal Dimension
```{r frac simplfied models}
# #Available model variables:
# sqrt.hdist.cont #Square Root Transformed Human Disturbance
# year #Expedition Year
# island.side #2 coarse regions of island side
# site #site (as random effect)
str(mpq.1cm)
head(mpq.1cm)

#Models
global.fractal.dimension <- lmer(fractal.dimension~ year * sqrt.hdist.cont + island.side + (1|site), data = mpq.1cm)

fractal.dimension1 <- lm(fractal.dimension ~ year, data = mpq.1cm) 
fractal.dimension2 <- lm(fractal.dimension ~ year + sqrt.hdist.cont, data = mpq.1cm)
fractal.dimension3 <- lm(fractal.dimension ~ year * sqrt.hdist.cont, data = mpq.1cm)
fractal.dimension4 <- lm(fractal.dimension ~ sqrt.hdist.cont, data = mpq.1cm)

fractal.dimension5 <- lm(fractal.dimension ~ year + sqrt.hdist.cont + island.side, data = mpq.1cm) 
fractal.dimension6 <- lm(fractal.dimension ~ year * sqrt.hdist.cont + island.side, data = mpq.1cm)
fractal.dimension7 <- lm(fractal.dimension~ year + island.side, data = mpq.1cm)

fractal.dimension8 <- lmer(fractal.dimension ~ year + sqrt.hdist.cont + island.side + (1|site), data = mpq.1cm)
fractal.dimension9 <- lmer(fractal.dimension ~ year * sqrt.hdist.cont + island.side + (1|site), data = mpq.1cm)
fractal.dimension10 <- lmer(fractal.dimension ~ year + sqrt.hdist.cont + (1|site), data = mpq.1cm)
fractal.dimension11 <- lmer(fractal.dimension ~ year * sqrt.hdist.cont + (1|site), data = mpq.1cm)
fractal.dimension12 <- lmer(fractal.dimension ~ year + (1|site), data = mpq.1cm)
fractal.dimension13 <- lmer(fractal.dimension ~ year + (1|site), data = mpq.1cm)

## AIC model selection
AIC_fractal.dimension.table <- model.sel(fractal.dimension1,fractal.dimension2,fractal.dimension3,fractal.dimension4,fractal.dimension5,fractal.dimension6,fractal.dimension7,fractal.dimension8,fractal.dimension9,fractal.dimension10,fractal.dimension11,fractal.dimension12, fractal.dimension13, global.fractal.dimension)

## AIC summary table 
names(AIC_fractal.dimension.table) <- c("(Int)", "Year", "Human Disturbance", "Disturbance*Year", "Island.Side", "Family", "Model.Class","df", "LL", "AICc", "∆AICc", "weight")
AIC_fractal.dimension.table$weight <- c(akaike.weights(AIC_fractal.dimension.table$AICc)$weights)

#Top Models within 4AIC
summary(fractal.dimension5)
summary(fractal.dimension6)


#Check out slopes of yearly differences
summary(fractal.dimension5)
emmeans(fractal.dimension5, pairwise ~ year) #Tests the differences between years

#See if leeward vs windward is significant and which side was higher
anova(fractal.dimension5)
frac.emm.island <- emmeans(fractal.dimension5, "island.side")
pairs(frac.emm.island) 

ggplot(mpq.1cm, aes(x=island.side, y=fractal.dimension)) + geom_boxplot()


#Check top model set variance homogeneity
par(mfrow=c(2,2))
plot(fractal.dimension5)
plot(fractal.dimension6)


#Durbin-Watson Test for autocorrelation
frac.dw <- dwtest(fractal.dimension5, order.by = NULL,alternative = c("greater", "two.sided", "less"),
       iterations = 15, exact = NULL, data = list())
frac.dw

#Breusch-Godfrey Test (Null = there is no serial correlation of any order up to p.)
bgtest(fractal.dimension ~ year + sqrt.hdist.cont + island.side, data = mpq.1cm, order=1) #P=0.2364





```

## Profile Curvature Range
```{r pro.range.log simplfied models}
# #Available model variables:
# sqrt.hdist.cont #Square Root Transformed Human Disturbance
# year #Expedition Year
# island.side #2 coarse regions of island side
# site #site (as random effect)

#Data
mpq.1cm 


#Models
global.pro.range.log <- lmer(pro.range.log~ year * sqrt.hdist.cont + island.side + (1|site), data = mpq.1cm)

pro.range.log1 <- lm(pro.range.log ~ year, data = mpq.1cm) 
pro.range.log2 <- lm(pro.range.log ~ year + sqrt.hdist.cont, data = mpq.1cm)
pro.range.log3 <- lm(pro.range.log ~ year * sqrt.hdist.cont, data = mpq.1cm)
pro.range.log4 <- lm(pro.range.log ~ sqrt.hdist.cont, data = mpq.1cm)

pro.range.log5 <- lm(pro.range.log ~ year + sqrt.hdist.cont + island.side, data = mpq.1cm) 
pro.range.log6 <- lm(pro.range.log ~ year * sqrt.hdist.cont + island.side, data = mpq.1cm)
pro.range.log7 <- lm(pro.range.log~ year + island.side, data = mpq.1cm)

pro.range.log8 <- lmer(pro.range.log ~ year + sqrt.hdist.cont + island.side + (1|site), data = mpq.1cm)
pro.range.log9 <- lmer(pro.range.log ~ year * sqrt.hdist.cont + island.side + (1|site), data = mpq.1cm)
pro.range.log10 <- lmer(pro.range.log ~ year + sqrt.hdist.cont + (1|site), data = mpq.1cm)
pro.range.log11 <- lmer(pro.range.log ~ year * sqrt.hdist.cont + (1|site), data = mpq.1cm)
pro.range.log12 <- lmer(pro.range.log ~ year + (1|site), data = mpq.1cm)

# pro.range.log13 <- glmmTMB(pro.range.log ~ year + (1|site), data = mpq.1cm)

## AIC model selection
AIC_pro.range.log.table <- model.sel(pro.range.log1,pro.range.log2,pro.range.log3,pro.range.log4,pro.range.log5,pro.range.log6,pro.range.log7,pro.range.log8,pro.range.log9,pro.range.log10,pro.range.log11,pro.range.log12, global.pro.range.log)

## AIC summary table 
names(AIC_pro.range.log.table) <- c("(Int)", "Year", "Human Disturbance", "Disturbance*Year", "Island.Side", "Family", "Model.Class","df", "LL", "AICc", "∆AICc", "weight")
AIC_pro.range.log.table$weight <- c(akaike.weights(AIC_pro.range.log.table$AICc)$weights)

#Top Models within 4AIC
summary(pro.range.log5)
summary(pro.range.log4)
summary(pro.range.log2)


#See which years are significantly different from one another
pro.emm.s <- emmeans(pro.range.log5, "year")
pairs(pro.emm.s) #None significantly different from one another
anova(pro.range.log5)

#See if leeward vs windward is significant and which side was higher
anova(pro.range.log5)
pro.emm.island <- emmeans(pro.range.log5, "island.side")
pairs(pro.emm.island) 

ggplot(mpq.1cm, aes(x=island.side, y=pro.range.log)) + geom_boxplot()

#Check top model set variance homogeneity
par(mfrow=c(2,2))
plot(pro.range.log5)
plot(pro.range.log4) #This one looks ODD....
plot(pro.range.log2) 



##### See year to year variation through simplified model output of year + 1|site
pro.year <- emmeans(pro.range.log12, "year")
pairs(pro.year) #2015-2017 sig different (2015-2016b close)


#Durbin-Watson Test for autocorrelation
pro.dw <- dwtest(pro.range.log5, order.by = NULL,alternative = c("greater", "two.sided", "less"),
       iterations = 15, exact = NULL, data = list())
pro.dw

#Breusch-Godfrey Test (Null = there is no serial correlation of any order up to p.)
bgtest(pro.range.log ~ year + sqrt.hdist.cont + island.side, data = mpq.1cm, order=1) #P=0.9443



```

## Planform Curvature Range
```{r plan.range.log simplfied models}
# #Available model variables:
# sqrt.hdist.cont #Square Root Transformed Human Disturbance
# year #Expedition Year
# island.side #2 coarse regions of island side
# site #site (as random effect)
# 

#Models
global.plan.range.log <- lmer(plan.range.log~ year * sqrt.hdist.cont + island.side + (1|site), data = mpq.1cm)

plan.range.log1 <- lm(plan.range.log ~ year, data = mpq.1cm) 
plan.range.log2 <- lm(plan.range.log ~ year + sqrt.hdist.cont, data = mpq.1cm)
plan.range.log3 <- lm(plan.range.log ~ year * sqrt.hdist.cont, data = mpq.1cm)
plan.range.log4 <- lm(plan.range.log ~ sqrt.hdist.cont, data = mpq.1cm)

plan.range.log5 <- lm(plan.range.log ~ year + sqrt.hdist.cont + island.side, data = mpq.1cm) 
plan.range.log6 <- lm(plan.range.log ~ year * sqrt.hdist.cont + island.side, data = mpq.1cm)
plan.range.log7 <- lm(plan.range.log~ year + island.side, data = mpq.1cm)

plan.range.log8 <- lmer(plan.range.log ~ year + sqrt.hdist.cont + island.side + (1|site), data = mpq.1cm)
plan.range.log9 <- lmer(plan.range.log ~ year * sqrt.hdist.cont + island.side + (1|site), data = mpq.1cm)
plan.range.log10 <- lmer(plan.range.log ~ year + sqrt.hdist.cont + (1|site), data = mpq.1cm)
plan.range.log11 <- lmer(plan.range.log ~ year * sqrt.hdist.cont + (1|site), data = mpq.1cm)
plan.range.log12 <- lmer(plan.range.log ~ year + (1|site), data = mpq.1cm)
plan.range.log13 <- lmer(plan.range.log ~ year + (1|site), data = mpq.1cm)

## AIC model selection
AIC_plan.range.log.table <- model.sel(plan.range.log1,plan.range.log2,plan.range.log3,plan.range.log4,plan.range.log5,plan.range.log6,plan.range.log7,plan.range.log8,plan.range.log9,plan.range.log10,plan.range.log11,plan.range.log12, plan.range.log13, global.plan.range.log)

## AIC summary table 
names(AIC_plan.range.log.table) <- c("(Int)", "Year", "Human Disturbance", "Disturbance*Year", "Island.Side", "Family", "Model.Class","df", "LL", "AICc", "∆AICc", "weight")
AIC_plan.range.log.table$weight <- c(akaike.weights(AIC_plan.range.log.table$AICc)$weights)

#Top Models within 4AIC
summary(plan.range.log2)
summary(plan.range.log5)


#See which years are significantly different from one another
plan.emm.s <- emmeans(plan.range.log2, "year")
pairs(plan.emm.s)
plot(plan.emm.s)
#Summary: 2015 sig different than all years but 2019. 2017 sig different than 2019.

#See if leeward vs windward is significant and which side was higher
anova(plan.range.log2)
plan.emm.island <- emmeans(plan.range.log2, "island.side")
pairs(plan.emm.island) 


#Check top model set variance homogeneity
par(mfrow=c(2,2))
plot(plan.range.log2)
plot(plan.range.log5)


#Durbin-Watson Test for autocorrelation
plan.dw <- dwtest(plan.range.log2, order.by = NULL,alternative = c("greater", "two.sided", "less"),
       iterations = 15, exact = NULL, data = list())
plan.dw

#Breusch-Godfrey Test (Null = there is no serial correlation of any order up to p.)
bgtest(plan.range.log ~ year + sqrt.hdist.cont, data = mpq.1cm, order=1) #P=0.4421



```

## Habitat Volume
```{r hab.vol simplified models}
# #Available model variables:
# sqrt.hdist.cont #Square Root Transformed Human Disturbance
# time.interval #Time interval between two samples taken
# island.side #2 coarse regions of island side
# site #site (as random effect)
# cc.2tps
hist(cc.2tps$volume.change)
hist((cc.2tps$volume.change)^2)
hist(1/(cc.2tps$volume.change))

par(mfrow=c(1,1))

str(cc.2tps$time.interval)
#Change to character
cc.2tps$time.interval <- as.character(cc.2tps$time.interval)


#Models
global.volume.change <- lmer(volume.change~ time.interval * sqrt.hdist.cont + island.side + (1|site), data = cc.2tps)

volume.change1 <- lm(volume.change ~ time.interval, data = cc.2tps) 
volume.change2 <- lm(volume.change ~ time.interval + sqrt.hdist.cont, data = cc.2tps)
volume.change3 <- lm(volume.change ~ time.interval * sqrt.hdist.cont, data = cc.2tps)
volume.change4 <- lm(volume.change ~ sqrt.hdist.cont, data = cc.2tps)

volume.change5 <- lm(volume.change ~ time.interval + sqrt.hdist.cont + island.side, data = cc.2tps) 
volume.change6 <- lm(volume.change ~ time.interval * sqrt.hdist.cont + island.side, data = cc.2tps)
volume.change7 <- lm(volume.change~ time.interval + island.side, data = cc.2tps)

volume.change8 <- lmer(volume.change ~ time.interval + sqrt.hdist.cont + island.side + (1|site), data = cc.2tps)
volume.change9 <- lmer(volume.change ~ time.interval * sqrt.hdist.cont + island.side + (1|site), data = cc.2tps)
volume.change10 <- lmer(volume.change ~ time.interval + sqrt.hdist.cont + (1|site), data = cc.2tps)
volume.change11 <- lmer(volume.change ~ time.interval * sqrt.hdist.cont + (1|site), data = cc.2tps)
volume.change12 <- lmer(volume.change ~ time.interval + (1|site), data = cc.2tps)
volume.change13 <- lmer(volume.change ~ time.interval + (1|site), data = cc.2tps)

## AIC model selection
AIC_volume.change.table <- model.sel(volume.change1,volume.change2,volume.change3,volume.change4,volume.change5,volume.change6,volume.change7,volume.change8,volume.change9,volume.change10,volume.change11,volume.change12, volume.change13, global.volume.change)

## AIC summary table 
names(AIC_volume.change.table) <- c("(Int)", "time.interval", "Human Disturbance", "Disturbance*time.interval", "Island.Side", "Family", "Model.Class","df", "LL", "AICc", "∆AICc", "weight")
AIC_volume.change.table$weight <- c(akaike.weights(AIC_volume.change.table$AICc)$weights)

#Top Models within 4AIC
summary(volume.change7)
summary(volume.change5)
summary(volume.change6)
summary(volume.change1)


#Compute Range of each boxplot
cc.2015to2017 <- cc.2tps[c(1:26),c(1:10)]
cc.2017to2019 <- cc.2tps[c(27:50),c(1:10)]
cc.2015to2019 <- CC.final[c(51:71),c(1:10)]

range(cc.2015to2017$volume.change) #-1.365 to 0.419
range(cc.2017to2019$volume.change) #-0.883 to 0.641
range(cc.2015to2019$volume.change) #-1.979 to 0.513 5/21 plots gained structure over period of study


#Reorder dataframe by disturbance publication site names (VH -- M -- VL)
row.names(cc.2015to2019) <- 1:nrow(cc.2015to2019) #Changes the row names so that they are re-orderd 1-80


#Summary:
summary(volume.change7)
anova(volume.change7)

#Time Interval (Not significant)
hab.vol7.mean <- emmeans(volume.change7, "time.interval")
pairs(hab.vol7.mean) #Sig difference between

#Island Side vs Leeward
hab.vol7.mean <- emmeans(volume.change7, "island.side")
pairs(hab.vol7.mean) #Sig difference between

# ggplot(cc.2tps, aes(x=island.side, y=volume.change)) + geom_boxplot()


#Check top model set variance homogeneity
# par(mfrow=c(2,2))
# plot(volume.change7)
# plot(volume.change5)
# plot(volume.change6)
# plot(volume.change1)

#Durbin-Watson Test for autocorrelation
habvol.dw <- dwtest(volume.change7, order.by = NULL,alternative = c("greater", "two.sided", "less"),
       iterations = 15, exact = NULL, data = list())
habvol.dw


#Breusch-Godfrey Test (Null = there is no serial correlation of any order up to p.)
bgtest(volume.change~ time.interval + island.side, data = cc.2tps, order=1) #P=0.505






```


# Sensitivity Analysis
```{r Sensitivity Analysis}
mpq.1cm #Full Dataset
cc #Full Habitat Volume Dataset

#Remove sites 15, 19, 37 from dataset
mpq.1cm.sen <- subset(mpq.1cm, site == "5" | site == "8" |site == "35" |site == "34" |site == "27" |site == "32" |site == "30")

cc.sen <- subset(cc.2tps, site == "5" | site == "8" |site == "35" |site == "34" |site == "27" |site == "32" |site == "30")

str(mpq.1cm.sen)

#Top Models Vs. Sensitivity Models (models lacking site 15,19,37)
vrm.top <- lm(vrm ~ year * sqrt.hdist.cont + region.3, data = mpq.1cm)
vrm.sen <- lm(vrm ~ year * sqrt.hdist.cont + region.3, data = mpq.1cm.sen)

summary(vrm.sen)
summary(vrm.top)

rug.sen <- lm(rug ~ year + sqrt.hdist.cont + region.3, data = mpq.1cm.sen) 
rug.top <- lm(rug ~ year + sqrt.hdist.cont + region.3, data = mpq.1cm)

summary(rug.sen)
summary(rug.top)

fractal.dimension.sen <- lm(fractal.dimension ~ year * sqrt.hdist.cont + region.3, data = mpq.1cm.sen)
fractal.dimension.top<- lm(fractal.dimension ~ year * sqrt.hdist.cont + region.3, data = mpq.1cm)

summary(fractal.dimension.sen)
summary(fractal.dimension.top)



pro.range.log.sen <- lm(pro.range.log ~ year + sqrt.hdist.cont + region.3, data = mpq.1cm.sen) 
pro.range.log.top <- lm(pro.range.log ~ year + sqrt.hdist.cont + region.3, data = mpq.1cm) 

summary(pro.range.log.sen)
summary(pro.range.log.top)


plan.range.log.sen <- lm(plan.range.log ~ year + region.3, data = mpq.1cm.sen)
plan.range.log.top <- lm(plan.range.log ~ year + region.3, data = mpq.1cm)

summary(plan.range.log.sen)
summary(plan.range.log.top)

volume.change.sen <- lm(volume.change~ time.interval + region.3, data = cc.sen)
volume.change.top <- lm(volume.change~ time.interval + region.3, data = cc)


summary(volume.change.sen)
summary(volume.change.top)

```

# DEM changes across resolutions 
## VRM
```{r VRM resolution modelling with top model}

#Models
global.vrm.4cm <- lmer(vrm~ year * sqrt.hdist.cont + island.side + (1|site), data = mpq.4cm)

vrm1.4cm <- lm(vrm ~ year, data = mpq.4cm) 
vrm2.4cm <- lm(vrm ~ year + sqrt.hdist.cont, data = mpq.4cm)
vrm3.4cm <- lm(vrm ~ year * sqrt.hdist.cont, data = mpq.4cm)
vrm4.4cm <- lm(vrm ~ sqrt.hdist.cont, data = mpq.4cm)

vrm5.4cm <- lm(vrm ~ year + sqrt.hdist.cont + island.side, data = mpq.4cm) 
vrm6.4cm <- lm(vrm ~ year * sqrt.hdist.cont + island.side, data = mpq.4cm)
vrm7.4cm <- lm(vrm~ year + island.side, data = mpq.4cm)

vrm8.4cm <- lmer(vrm ~ year + sqrt.hdist.cont + island.side + (1|site), data = mpq.4cm)
vrm9.4cm <- lmer(vrm ~ year * sqrt.hdist.cont + island.side + (1|site), data = mpq.4cm)
vrm10.4cm <- lmer(vrm ~ year + sqrt.hdist.cont + (1|site), data = mpq.4cm)
vrm11.4cm <- lmer(vrm ~ year * sqrt.hdist.cont + (1|site), data = mpq.4cm)
vrm12.4cm <- lmer(vrm ~ year + (1|site), data = mpq.4cm)
vrm13.4cm <- lmer(vrm ~ year + (1|site), data = mpq.4cm)

## AIC model selection
AIC_vrm.table.4cm <- model.sel(vrm1.4cm,vrm2.4cm,vrm3.4cm,vrm4.4cm,vrm5.4cm,vrm6.4cm,vrm7.4cm,vrm8.4cm,vrm9.4cm,vrm10.4cm,vrm11.4cm,vrm12.4cm, vrm13.4cm, global.vrm.4cm)

## AIC summary table 
names(AIC_vrm.table.4cm) <- c("(Int)", "Year", "Human Disturbance", "Disturbance*Year", "Island.Side", "Family", "Model.Class","df", "LL", "AICc", "∆AICc", "weight")
AIC_vrm.table.4cm$weight <- c(akaike.weights(AIC_vrm.table.4cm$AICc)$weights)

#Top Model at 4cm: 
vrm5.4cm

#Summary:
summary(vrm5.4cm)
anova(vrm5.4cm)
vrm.4cm.mean <- emmeans(vrm5.4cm, "year")
pairs(vrm.4cm.mean)

#Summary: 
#Island Side and hum_dist are sig
#Year is still significant for some year combinations (2015- 2016b,2017, 2017-2019)

#Model variance test
plot(vrm5.4cm,3)


#<------
#8cm DEM
#Models
global.vrm.8cm <- lmer(vrm~ year * sqrt.hdist.cont + island.side + (1|site), data = mpq.8cm)

vrm1.8cm <- lm(vrm ~ year, data = mpq.8cm) 
vrm2.8cm <- lm(vrm ~ year + sqrt.hdist.cont, data = mpq.8cm)
vrm3.8cm <- lm(vrm ~ year * sqrt.hdist.cont, data = mpq.8cm)
vrm4.8cm <- lm(vrm ~ sqrt.hdist.cont, data = mpq.8cm)

vrm5.8cm <- lm(vrm ~ year + sqrt.hdist.cont + island.side, data = mpq.8cm) 
vrm6.8cm <- lm(vrm ~ year * sqrt.hdist.cont + island.side, data = mpq.8cm)
vrm7.8cm <- lm(vrm~ year + island.side, data = mpq.8cm)

vrm8.8cm <- lmer(vrm ~ year + sqrt.hdist.cont + island.side + (1|site), data = mpq.8cm)
vrm9.8cm <- lmer(vrm ~ year * sqrt.hdist.cont + island.side + (1|site), data = mpq.8cm)
vrm10.8cm <- lmer(vrm ~ year + sqrt.hdist.cont + (1|site), data = mpq.8cm)
vrm11.8cm <- lmer(vrm ~ year * sqrt.hdist.cont + (1|site), data = mpq.8cm)
vrm12.8cm <- lmer(vrm ~ year + (1|site), data = mpq.8cm)
vrm13.8cm <- lmer(vrm ~ year + (1|site), data = mpq.8cm)

## AIC model selection
AIC_vrm.table.8cm <- model.sel(vrm1.8cm,vrm2.8cm,vrm3.8cm,vrm4.8cm,vrm5.8cm,vrm6.8cm,vrm7.8cm,vrm8.8cm,vrm9.8cm,vrm10.8cm,vrm11.8cm,vrm12.8cm, vrm13.8cm, global.vrm.8cm)

## AIC summary table 
names(AIC_vrm.table.8cm) <- c("(Int)", "Year", "Human Disturbance", "Disturbance*Year", "Island.Side", "Family", "Model.Class","df", "LL", "AICc", "∆AICc", "weight")
AIC_vrm.table.8cm$weight <- c(akaike.weights(AIC_vrm.table.8cm$AICc)$weights)

#Top 8cm Model:
vrm5.8cm

#8cm Resolution
summary(vrm5.8cm)
anova(vrm5.8cm)
vrm.8cm <- emmeans(vrm5.8cm, "year")
pairs(vrm.8cm)

#Summary: 
#All years are no longer sig different
#Island side + human disturbance are sig different still

#Model variance test
par(mfrow=c(2,2))
plot(vrm5.8cm)
plot(vrm4.8cm) #Ehhhh not so great
plot(vrm2.8cm)

```

## Surface Complexity
```{r SC resolution modelling with top model}
#Models
global.rug.4cm <- lmer(rug~ year * sqrt.hdist.cont + island.side + (1|site), data = mpq.4cm)

rug1.4cm <- lm(rug ~ year, data = mpq.4cm) 
rug2.4cm <- lm(rug ~ year + sqrt.hdist.cont, data = mpq.4cm)
rug3.4cm <- lm(rug ~ year * sqrt.hdist.cont, data = mpq.4cm)
rug4.4cm <- lm(rug ~ sqrt.hdist.cont, data = mpq.4cm)

rug5.4cm <- lm(rug ~ year + sqrt.hdist.cont + island.side, data = mpq.4cm) 
rug6.4cm <- lm(rug ~ year * sqrt.hdist.cont + island.side, data = mpq.4cm)
rug7.4cm <- lm(rug~ year + island.side, data = mpq.4cm)

rug8.4cm <- lmer(rug ~ year + sqrt.hdist.cont + island.side + (1|site), data = mpq.4cm)
rug9.4cm <- lmer(rug ~ year * sqrt.hdist.cont + island.side + (1|site), data = mpq.4cm)
rug10.4cm <- lmer(rug ~ year + sqrt.hdist.cont + (1|site), data = mpq.4cm)
rug11.4cm <- lmer(rug ~ year * sqrt.hdist.cont + (1|site), data = mpq.4cm)
rug12.4cm <- lmer(rug ~ year + (1|site), data = mpq.4cm)

## AIC model selection
AIC_rug.table.4cm <- model.sel(rug1.4cm,rug2.4cm,rug3.4cm,rug4.4cm,rug5.4cm,rug6.4cm,rug7.4cm,rug8.4cm,rug9.4cm,rug10.4cm,rug11.4cm,rug12.4cm,global.rug.4cm)

## AIC summary table 
names(AIC_rug.table.4cm) <- c("(Int)", "Year", "Human Disturbance", "Disturbance*Year", "Island.Side", "Family", "Model.Class","df", "LL", "AICc", "∆AICc", "weight")
AIC_rug.table.4cm$weight <- c(akaike.weights(AIC_rug.table.4cm$AICc)$weights)

#Play around with transforming the data
# hist(mpq.4cm$rug)
# hist((mpq.4cm$rug)^2)
# hist(1/(mpq.4cm$rug))

#Summary:
#4cm Resolution top model: rug5.4cm
summary(rug5.4cm)
anova(rug5.4cm)
rug.emm.4cm <- emmeans(rug5.4cm, "year")
pairs(rug.emm.4cm)

#Summary:
#Island.Side & Human disturbance gradient by itself is significant
#Year differences are no longer significant

#Check model variance
par(mfrow=c(2,2))
plot(rug5.4cm)
plot(rug12.4cm)
plot(rug4.4cm)
plot(rug2.4cm)

#<----------------
#8cm Resolution
#Models
global.rug.8cm <- lmer(rug~ year * sqrt.hdist.cont + island.side + (1|site), data = mpq.8cm)

rug1.8cm <- lm(rug ~ year, data = mpq.8cm) 
rug2.8cm <- lm(rug ~ year + sqrt.hdist.cont, data = mpq.8cm)
rug3.8cm <- lm(rug ~ year * sqrt.hdist.cont, data = mpq.8cm)
rug4.8cm <- lm(rug ~ sqrt.hdist.cont, data = mpq.8cm)

rug5.8cm <- lm(rug ~ year + sqrt.hdist.cont + island.side, data = mpq.8cm) 
rug6.8cm <- lm(rug ~ year * sqrt.hdist.cont + island.side, data = mpq.8cm)
rug7.8cm <- lm(rug~ year + island.side, data = mpq.8cm)

rug8.8cm <- lmer(rug ~ year + sqrt.hdist.cont + island.side + (1|site), data = mpq.8cm)
rug9.8cm <- lmer(rug ~ year * sqrt.hdist.cont + island.side + (1|site), data = mpq.8cm)
rug10.8cm <- lmer(rug ~ year + sqrt.hdist.cont + (1|site), data = mpq.8cm)
rug11.8cm <- lmer(rug ~ year * sqrt.hdist.cont + (1|site), data = mpq.8cm)
rug12.8cm <- lmer(rug ~ year + (1|site), data = mpq.8cm)
rug13.8cm <- lmer(rug ~ year + (1|site), data = mpq.8cm)

## AIC model selection
AIC_rug.table.8cm <- model.sel(rug1.8cm,rug2.8cm,rug3.8cm,rug4.8cm,rug5.8cm,rug6.8cm,rug7.8cm,rug8.8cm,rug9.8cm,rug10.8cm,rug11.8cm,rug12.8cm, rug13.8cm, global.rug.8cm)

## AIC summary table 
names(AIC_rug.table.8cm) <- c("(Int)", "Year", "Human Disturbance", "Disturbance*Year", "Island.Side", "Family", "Model.Class","df", "LL", "AICc", "∆AICc", "weight")
AIC_rug.table.8cm$weight <- c(akaike.weights(AIC_rug.table.8cm$AICc)$weights)



#Top 8cm Resolution: rug6.8cm
rug4.8cm
summary(rug4.8cm)
anova(rug4.8cm)

#Summary:
#Human disturbance remains significant, nothing else does (diff between years nor island.side)

#Model Variance test
plot(rug4.8cm)


```

## Profile Curvature
```{r ProCurvRange resolution modelling with top model}
#4cm Resolution Models
global.pro.range.log.4cm <- lmer(pro.range.log~ year * sqrt.hdist.cont + island.side + (1|site), data = mpq.4cm)

pro.range.log1.4cm <- lm(pro.range.log ~ year, data = mpq.4cm) 
pro.range.log2.4cm <- lm(pro.range.log ~ year + sqrt.hdist.cont, data = mpq.4cm)
pro.range.log3.4cm <- lm(pro.range.log ~ year * sqrt.hdist.cont, data = mpq.4cm)
pro.range.log4.4cm <- lm(pro.range.log ~ sqrt.hdist.cont, data = mpq.4cm)

pro.range.log5.4cm <- lm(pro.range.log ~ year + sqrt.hdist.cont + island.side, data = mpq.4cm) 
pro.range.log6.4cm <- lm(pro.range.log ~ year * sqrt.hdist.cont + island.side, data = mpq.4cm)
pro.range.log7.4cm <- lm(pro.range.log~ year + island.side, data = mpq.4cm)

pro.range.log8.4cm <- lmer(pro.range.log ~ year + sqrt.hdist.cont + island.side + (1|site), data = mpq.4cm)
pro.range.log9.4cm <- lmer(pro.range.log ~ year * sqrt.hdist.cont + island.side + (1|site), data = mpq.4cm)
pro.range.log10.4cm <- lmer(pro.range.log ~ year + sqrt.hdist.cont + (1|site), data = mpq.4cm)
pro.range.log11.4cm <- lmer(pro.range.log ~ year * sqrt.hdist.cont + (1|site), data = mpq.4cm)
pro.range.log12.4cm <- lmer(pro.range.log ~ year + (1|site), data = mpq.4cm)
pro.range.log13.4cm <- lmer(pro.range.log ~ year + (1|site), data = mpq.4cm)

## AIC model selection
AIC_pro.range.log.table.4cm <- model.sel(pro.range.log1.4cm, pro.range.log2.4cm, pro.range.log3.4cm, pro.range.log4.4cm, pro.range.log5.4cm, pro.range.log6.4cm, pro.range.log7.4cm, pro.range.log8.4cm, pro.range.log9.4cm, pro.range.log10.4cm, pro.range.log11.4cm, pro.range.log12.4cm, pro.range.log13.4cm, global.pro.range.log.4cm)

## AIC summary table 
names(AIC_pro.range.log.table.4cm) <- c("(Int)", "Year", "Human Disturbance", "Disturbance*Year", "Island.Side", "Family", "Model.Class","df", "LL", "AICc", "∆AICc", "weight")
AIC_pro.range.log.table.4cm$weight <- c(akaike.weights(AIC_pro.range.log.table.4cm$AICc)$weights)

#Summary 4cm Resolution
summary(pro.range.log5.4cm)
anova(pro.range.log5.4cm)
pro.range.4cm.mean <- emmeans(pro.range.log5.4cm, "year")
pairs(pro.range.4cm.mean)

#Summary:
#Difference between years is no longer significant
#Human disturbance gradient is significant
#Island Side is significant


#Model Variance test
plot(pro.range.log5.4cm,3)


#<-----------------------
#Models 4cm Resolution
global.pro.range.log.8cm <- lmer(pro.range.log~ year * sqrt.hdist.cont + island.side + (1|site), data = mpq.8cm)

pro.range.log1.8cm <- lm(pro.range.log ~ year, data = mpq.8cm) 
pro.range.log2.8cm <- lm(pro.range.log ~ year + sqrt.hdist.cont, data = mpq.8cm)
pro.range.log3.8cm <- lm(pro.range.log ~ year * sqrt.hdist.cont, data = mpq.8cm)
pro.range.log4.8cm <- lm(pro.range.log ~ sqrt.hdist.cont, data = mpq.8cm)

pro.range.log5.8cm <- lm(pro.range.log ~ year + sqrt.hdist.cont + island.side, data = mpq.8cm) 
pro.range.log6.8cm <- lm(pro.range.log ~ year * sqrt.hdist.cont + island.side, data = mpq.8cm)
pro.range.log7.8cm <- lm(pro.range.log~ year + island.side, data = mpq.8cm)

pro.range.log8.8cm <- lmer(pro.range.log ~ year + sqrt.hdist.cont + island.side + (1|site), data = mpq.8cm)
pro.range.log9.8cm <- lmer(pro.range.log ~ year * sqrt.hdist.cont + island.side + (1|site), data = mpq.8cm)
pro.range.log10.8cm <- lmer(pro.range.log ~ year + sqrt.hdist.cont + (1|site), data = mpq.8cm)
pro.range.log11.8cm <- lmer(pro.range.log ~ year * sqrt.hdist.cont + (1|site), data = mpq.8cm)
pro.range.log12.8cm <- lmer(pro.range.log ~ year + (1|site), data = mpq.8cm)

## AIC model selection
AIC_pro.range.log.table.8cm <- model.sel(pro.range.log1.8cm, pro.range.log2.8cm, pro.range.log3.8cm, pro.range.log4.8cm, pro.range.log5.8cm, pro.range.log6.8cm, pro.range.log7.8cm, pro.range.log8.8cm, pro.range.log9.8cm, pro.range.log10.8cm, pro.range.log11.8cm, pro.range.log12.8cm, global.pro.range.log.8cm)

## AIC summary table 
names(AIC_pro.range.log.table.8cm) <- c("(Int)", "Year", "Human Disturbance", "Disturbance*Year", "Island.Side", "Family", "Model.Class","df", "LL", "AICc", "∆AICc", "weight")
AIC_pro.range.log.table.8cm$weight <- c(akaike.weights(AIC_pro.range.log.table.8cm$AICc)$weights)



#Summary 8cm Resolution
summary(pro.range.log12.8cm)
anova(pro.range.log12.8cm)
pro.range.8cm.mean <- emmeans(pro.range.log12.8cm, "year")
pairs(pro.range.8cm.mean)


#Compare top two models
anova(pro.range.log12.8cm) #Random Effect included
anova(pro.range.log4.8cm) #Fixed effect of human disturbance

#Model Variance
par(mfrow=c(2,2))
plot(pro.range.log12.8cm)
plot(pro.range.log4.8cm) #Not great....
plot(pro.range.log2.8cm)



```

## Planform Curvature
```{r PlanCurvRange resolution modelling with top model}
#4cm Resolution Models
global.plan.range.log.4cm <- lmer(plan.range.log~ year * sqrt.hdist.cont + island.side + (1|site), data = mpq.4cm)

plan.range.log1.4cm <- lm(plan.range.log ~ year, data = mpq.4cm) 
plan.range.log2.4cm <- lm(plan.range.log ~ year + sqrt.hdist.cont, data = mpq.4cm)
plan.range.log3.4cm <- lm(plan.range.log ~ year * sqrt.hdist.cont, data = mpq.4cm)
plan.range.log4.4cm <- lm(plan.range.log ~ sqrt.hdist.cont, data = mpq.4cm)

plan.range.log5.4cm <- lm(plan.range.log ~ year + sqrt.hdist.cont + island.side, data = mpq.4cm) 
plan.range.log6.4cm <- lm(plan.range.log ~ year * sqrt.hdist.cont + island.side, data = mpq.4cm)
plan.range.log7.4cm <- lm(plan.range.log~ year + island.side, data = mpq.4cm)

plan.range.log8.4cm <- lmer(plan.range.log ~ year + sqrt.hdist.cont + island.side + (1|site), data = mpq.4cm)
plan.range.log9.4cm <- lmer(plan.range.log ~ year * sqrt.hdist.cont + island.side + (1|site), data = mpq.4cm)
plan.range.log10.4cm <- lmer(plan.range.log ~ year + sqrt.hdist.cont + (1|site), data = mpq.4cm)
plan.range.log11.4cm <- lmer(plan.range.log ~ year * sqrt.hdist.cont + (1|site), data = mpq.4cm)
plan.range.log12.4cm <- lmer(plan.range.log ~ year + (1|site), data = mpq.4cm)
plan.range.log13.4cm <- lmer(plan.range.log ~ year + (1|site), data = mpq.4cm)

## AIC model selection
AIC_plan.range.log.table.4cm <- model.sel(plan.range.log1.4cm, plan.range.log2.4cm, plan.range.log3.4cm, plan.range.log4.4cm, plan.range.log5.4cm, plan.range.log6.4cm, plan.range.log7.4cm, plan.range.log8.4cm, plan.range.log9.4cm, plan.range.log10.4cm, plan.range.log11.4cm, plan.range.log12.4cm, plan.range.log13.4cm, global.plan.range.log.4cm)

## AIC summary table 
names(AIC_plan.range.log.table.4cm) <- c("(Int)", "Year", "Human Disturbance", "Disturbance*Year", "Island.Side", "Family", "Model.Class","df", "LL", "AICc", "∆AICc", "weight")
AIC_plan.range.log.table.4cm$weight <- c(akaike.weights(AIC_plan.range.log.table.4cm$AICc)$weights)

#Summary 4cm Resolution
summary(plan.range.log5.4cm)
anova(plan.range.log5.4cm)
plan.range.4cm.mean <- emmeans(plan.range.log5.4cm, "year")
pairs(plan.range.4cm.mean)

#Summary:
#Difference between years is no longer significant when conducting post-hoc comparisons
#Human disturbance gradient is significant
#Island Side is significant


#Model Variance test
par(mfrow=c(2,2))
plot(plan.range.log5.4cm)
plot(plan.range.log2.4cm)


#<-----------------------
#Models 8cm Resolution
global.plan.range.log.8cm <- lmer(plan.range.log~ year * sqrt.hdist.cont + island.side + (1|site), data = mpq.8cm)

plan.range.log1.8cm <- lm(plan.range.log ~ year, data = mpq.8cm) 
plan.range.log2.8cm <- lm(plan.range.log ~ year + sqrt.hdist.cont, data = mpq.8cm)
plan.range.log3.8cm <- lm(plan.range.log ~ year * sqrt.hdist.cont, data = mpq.8cm)
plan.range.log4.8cm <- lm(plan.range.log ~ sqrt.hdist.cont, data = mpq.8cm)

plan.range.log5.8cm <- lm(plan.range.log ~ year + sqrt.hdist.cont + island.side, data = mpq.8cm) 
plan.range.log6.8cm <- lm(plan.range.log ~ year * sqrt.hdist.cont + island.side, data = mpq.8cm)
plan.range.log7.8cm <- lm(plan.range.log~ year + island.side, data = mpq.8cm)

plan.range.log8.8cm <- lmer(plan.range.log ~ year + sqrt.hdist.cont + island.side + (1|site), data = mpq.8cm)
plan.range.log9.8cm <- lmer(plan.range.log ~ year * sqrt.hdist.cont + island.side + (1|site), data = mpq.8cm)
plan.range.log10.8cm <- lmer(plan.range.log ~ year + sqrt.hdist.cont + (1|site), data = mpq.8cm)
plan.range.log11.8cm <- lmer(plan.range.log ~ year * sqrt.hdist.cont + (1|site), data = mpq.8cm)
plan.range.log12.8cm <- lmer(plan.range.log ~ year + (1|site), data = mpq.8cm)

## AIC model selection
AIC_plan.range.log.table.8cm <- model.sel(plan.range.log1.8cm, plan.range.log2.8cm, plan.range.log3.8cm, plan.range.log4.8cm, plan.range.log5.8cm, plan.range.log6.8cm, plan.range.log7.8cm, plan.range.log8.8cm, plan.range.log9.8cm, plan.range.log10.8cm, plan.range.log11.8cm, plan.range.log12.8cm, global.plan.range.log.8cm)

## AIC summary table 
names(AIC_plan.range.log.table.8cm) <- c("(Int)", "Year", "Human Disturbance", "Disturbance*Year", "Island.Side", "Family", "Model.Class","df", "LL", "AICc", "∆AICc", "weight")
AIC_plan.range.log.table.8cm$weight <- c(akaike.weights(AIC_plan.range.log.table.8cm$AICc)$weights)



#Summary 8cm Resolution
summary(plan.range.log2.8cm)
anova(plan.range.log2.8cm)
plan.range.8cm.mean <- emmeans(plan.range.log2.8cm, "year")
pairs(plan.range.8cm.mean)



#Model Variance test
par(mfrow=c(2,2))
plot(plan.range.log2.8cm) 
plot(plan.range.log4.8cm) 
plot(plan.range.log5.8cm)

```


# Prepare data for publication upload
```{r}
#IE: Make this into R data
mpq.1cm <- read.csv("~/Desktop/GitHub/Bruce_MPQ_Analysis/Data/BaumLab_Complexity_FULL_1cm_Data_14Jan21.csv", row.names=1)
colnames(mpq.1cm)
mpq.structure <- subset(mpq.1cm, select = c("year", "pub.site", "site", "ppq", "hum_dist", "sqrt.hdist.cont", "island.side", "vrm", "rug", "fractal.dimension",  "pro.range.log", "plan.range.log"))

#Change colnames
names(mpq.structure)[names(mpq.structure) == "rug"] <- "sc" #rug to sc
names(mpq.structure)[names(mpq.structure) == "pro.range.log"] <- "pro.range" #pro.range.log to pro.range
names(mpq.structure)[names(mpq.structure) == "plan.range.log"] <- "plan.range"#plan.range.log to plan.range
names(mpq.structure)[names(mpq.structure) == "hum_dist"] <- "gradient"#plan.range.log to plan.range
names(mpq.structure)[names(mpq.structure) == "sqrt.hdist.cont"] <- "dist"#plan.range.log to plan.range
names(mpq.structure)[names(mpq.structure) == "island.side"] <- "exposure"#plan.range.log to plan.range

#Save as Rdata for publication
save(mpq.structure, file = "StructuralComplexityData.RData")
# OLD VERSION save(mpq.1cm, file = "StructuralComplexityData.RData")


```


