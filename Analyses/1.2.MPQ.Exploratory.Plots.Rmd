---
title: "1.2.MPQ.Exploratory.Plots"
author: "Kevin Bruce"
date: "07/10/2020"
output:
  html_document:
    toc: yes
    toc_depth: 3
    toc_float: yes
---

```{r load data and packages, include=FALSE}
#Load Packages
library(dplyr)
library(ggplot2)
library(stats)
library(Rmisc)
library(here)
library(ggpmisc)
library(knitr)
library(magick)
library(gridExtra)
library(car)
library(tidyr)
library(readxl)
library(vegan)
library(tidyverse)

#Set Wd
setwd("~/Desktop/GitHub/Bruce_MPQ_Analysis/Data") 

#Load Data
CC <- read.csv("BaumLab_CloudCompare_Data_Clean.csv")
mpq <- read.csv("BaumLab_Complexity_Data_Clean.csv")
dig <- read.csv("BaumLab_Digitization_Data_Clean.csv")

#<----- Create subset dataframes for future plots ----->
#1a. CloudCompare
#Create a new dataframe for overall volume losses explained (2015-2019) ***Note: No Site 37 is included
CC.overall <- subset (CC, timepoint == "2015-2019")

#Create new dataframe excluding total changes
CC.progress <- subset (CC, timepoint == "2015-2017" | timepoint == "2017-2019") 

#1b. Change levels in CC for timepoint
levels(CC$timepoint)
CC$timepoint <- factor(CC$timepoint, levels = c("2015-2017", "2017-2019", "2015-2019"))

#1c. Change levels in CC.progress for hum_dist
levels(CC.progress$hum_dist)
CC.progress$hum_dist <- factor(CC.progress$hum_dist, levels = c("Very Low", "Medium", "Very High"))

#Create specific dataframes including Site 37&5 together, and only site5. Site 37 not sampled in 2015, so its proving troublesome
CC.vaskess5 <- subset (CC.progress, site == 5) 
CC.vaskess5.37 <- subset(CC.progress, site ==5 | site==37)

#2. ArcMap Complexity
#Setting up the intial dataframe to show the changes (or lack thereof) of plot 2d size through time
str(mpq)
mpq$ppq<- as.factor(mpq$ppq)

#<----- create sub-set dataframes for mpq complexity at each DEM resolution ----> 
#1cm DEM
mpq.1 <- mpq[mpq$DEM == 1,] 
mpq.1$site.ppq <- paste(mpq.1$site, mpq.1$ppq, sep=".")  #Make Unique collumns for Site.plot

#4cm DEM
mpq.4 <- mpq[mpq$DEM == 4,] 
mpq.4$site.ppq <- paste(mpq.4$site, mpq.4$ppq, sep=".") #Make Unique collumns for Site.plot

#8cm DEM
mpq.8 <- mpq[mpq$DEM == 8,] 
mpq.8$site.ppq <- paste(mpq.8$site, mpq.8$ppq, sep=".") #Make Unique collumns for Site.plot


#<----- Digitization Data work ----->

#<------Set Colour Pallettes for each morphology type ----->
morph.cols <- c("seagreen3", "Medium Spring Green", "Chartreuse", "Forest Green", "Spring Green","palegreen2", "mediumseagreen", "darkseagreen3", "Yellow Green", "Green Yellow", "Light Green", "Orchid", "Pale Violet Red", "Cyan", "Dark Turquoise", "Deep Sky Blue", "Dodger Blue", "Dark Blue","Gray80", "Gray75", "Gray70","Gray65","Gray60","Gray55", "Wheat", "Sandy Brown")
morph.colscale<- scale_fill_manual(name="", values=morph.cols, breaks=rev(c("Live_Branching", "Live_Columnar", "Live_Digitate", "Live_Encrusting", "Live_Encrusting_Columnar", "Live_Foliose", "Live_FreeLiving", "Live_Massive", "Live_Massive_Grooved", "Live_Porites", "Live_SubMassive", "Live_Tabulate", "SoftCoral_Nodular", "SoftCoral_Plating", "NonCoral_Branching", "NonCoral_Encrusting", "NonCoral_Massive", "NonCoral_SubMassive", "Macroalgae", "Dead_Branching", "Dead_Columnar", "Dead_Foliose", "Dead_Massive", "Dead_Tabulate", "Dead_SoftCoral", "Rubble", "Sand")))



#<---------- Plot for Julia's Duke Presentation ------------->
mpq.1

#New subset dataframe of 3 timepoints
mpq.1.3tp <- subset(mpq.1, year == 2015 | year == 2017 | year == 2019) 

#Set colour pallete to match Jenns study

#<------Set Colour Pallettes for year & human disturbance ----->
year.cols <- c("#99CCFF", "#4da6ff", "#006699")
year.colscale<- scale_fill_manual(name="", values=year.cols, breaks=c("2015", "2017", "2019")) 

mpq.1.3tp$year.dist <- paste(mpq.1.3tp$year, mpq.1.3tp$hum_dist, sep = ".")

mpq.1.3tp$year.dist <- as.factor(mpq.1.3tp$year.dist)

levels(mpq.1.3tp$year.dist)

mpq.1.3tp$year.dist <- factor(mpq.1.3tp$year.dist, levels = c("2015.Very High", "2017.Very High", "2019.Very High", "2015.Medium", "2017.Medium", "2019.Medium", "2015.Very Low", "2017.Very Low", "2019.Very Low"))

levels(mpq.1.3tp$year.dist)
levels(mpq.1.3tp$hum_dist)
mpq.1.3tp$hum_dist <- factor(mpq.1.3tp$hum_dist, levels = c("Very Low", "Medium", "Very High"))

hum.cols <- rev(c("#80CDC1","#35978f", "#01665E", "#F6E8C3", "#DFC27D", "#D8b365", "#BF812D", "#ad6217","#663300"))
hum.colscale <- scale_fill_manual(name="", values=hum.cols, breaks = c("2015.Very High", "2017.Very High", "2019.Very High", "2015.Medium", "2017.Medium", "2019.Medium", "2015.Very Low", "2017.Very Low", "2019.Very Low"))

```

# Exploratory plots for MPQ data ranging from 2015 - 2019

## Introduction 
Kiritimati Research Project- PPQ complexity analyses 2015 - 2019

Expedition years:
- 2015: July 2015
- 2016a: March 2016
- 2016b: November 2016
- 2017: July 2017
- 2019: July 2019

PPQ = Permanent Photoquadrat (16m2)

This document is for the PPQ data collected on Kiritimati to look at complexity changes that occur on reefs following a mass mortality event.

The plots below show a view of the data across different spatial and temporal scales. We will start by looking at the data broadly before zooming in to specific PPQ fluctuations over time. 

It is important to note that Sites 15 and 19 (both within the Very Low disturbance category) were unable to be sampled in March 2016 & 2019 due to weather. Site 37 (VL4) was installed in 2017 and has been sampled in both 2017 and 2019. 

```{r map, echo=FALSE, fig.height=11, fig.width=7, fig.align="center"}
map <- image_read("~/Desktop/GitHub/Bruce_MPQ_Analysis/Data/html.inserts/map-1.png")
map

```


## Site data available
Below is a table indicating the various sites around Kiritimati and how many MPQ's were sampled during each expedition

```{r Table for Julia, echo=FALSE, fig.align="center"}
map1 <- image_read("~/Desktop/GitHub/Bruce_MPQ_Analysis/Data/html.inserts/sites.table.png")
map1

```


## The 6 complexity metrics collected from each MPQ
1. Habitat Volumetric Change
2. Surface complexity
3. Terrain Ruggedness (VRM)
4. Slope
5. Profile Curvature
6. Planform Curvature

This document will take us through each of these metrics at various levels of detail. Starting broad, we'll eventually be looking at the individual plot's changes through out the years and across DEM scales (except Volumetric Change, which cannot be examined at different resolution scales).





# 1. Habitat Volumetric Change {.tabset}

- Volumetric change between 2015-2017 and 2015-2019 was quantified in CloudCompare, with the volume change (VC) between 2017 - 2019 calculated algebraically from the equation below for all sites except 37, which was initially sampled in 2017. 

 **2017 - 2019 VC = (2015-2019 VC) - (2015-2017 VC)**



## Volumetric Change at each of the three timepoints 

- Plot indicates volumetric change at the two timepoints sampled, with an "overall" change from 2015 - 2019 category added

- Significantly different volumetric change occurred during the 2017-2019 timepoint from the other two plotted

*Statistical Results:*

- The 2017-2019 timepoint is significantly different from the 2015-2017 timepoint (however not from 2015-2019)- via ANOVA.

```{r CC plots for meeting with JKB, echo=FALSE}
#1. Plot overall changes at each timepoint (2015-2017, 2017-2019, & 2015-2019)
ggplot(CC, aes(timepoint, volume.change)) + geom_boxplot(fill="deepskyblue") + xlab("Years encompassed in study") + ylab("Volumetric Change(m3)") +  geom_hline(yintercept = 0, linetype="dashed", color="red", size=0.2) + geom_label(label= "p=0.0436", x= 2, y=-1.2, label.size= 0.5, label.padding= unit(0.5, "lines"), fill= "grey", color="black")

# cc.aov <- aov(volume.change~timepoint, data=CC)
# summary(cc.aov)
# TukeyHSD(cc.aov)

```


## 2-year increment volumetric change

- An extremely similar plot to the one above, however this one breaks down the volume change into 2-year increments. 

- Significantly (T-test) difference in volumetric change between the 2015-2017 and 2017-2019 timepoints. 

- Larger variation in the initial years of the study 


```{r 2yr increment, echo=FALSE}
#2. Volume changes in 2 year increments
ggplot(CC.progress, aes(timepoint, volume.change)) + geom_boxplot(fill="deepskyblue") + xlab("Years") + ylab("Volumetric Change(m3)") +  geom_hline(yintercept = 0, linetype="dashed", color="red", size=0.2) + geom_label(label= "p=0.01", x= 2, y=-1.2, label.size= 0.5, label.padding= unit(0.5, "lines"), fill= "grey", color="black")

#Did a T test in minitab to check this one (couldn't get it to work in R)

```

## Volumetric Change ~ Human Disturbance 

- Lowered volumetric loss in the latter timepoint occurred in both Very Low and Very High disturbance levels

- However, rubble transport is extremely high at the Very High sites, so this result needs to be taken with a grain of salt

- Medium disturbance sites experienced very limited volumetric change at either timepoint

- This is believed to be the case due to a large storm in January 2015 destroying most of the more "complex" corals (primarily branching and foliose) and in removing those form the reef, left the less-complex, massive and submassive structure which is harder to erode and/or degrades slower

```{r change ~ dist, echo=FALSE}
ggplot(CC.progress, aes(timepoint, volume.change)) + geom_boxplot(fill="deepskyblue") +facet_wrap(~hum_dist, scales = "fixed", ncol= 3) + xlab("Years") + ylab("Volumetric Change(m3)") +  geom_hline(yintercept = 0, linetype="dashed", color="red", size=0.2)+ theme(axis.text.x = element_text(angle = 270, vjust = 1.1, hjust=1))#+ geom_label(label= "p=0.0748", x= 1, y=-1.0, label.size= 0.01, label.padding= unit(0.01, "lines"), fill= "grey", color="black") 
```

## Volumetric Change ~ Region

There are 4 regions in this study:

- BOW = Bay of wrecks (Very Low Disturbance)
- N.Lagoon = North Lagoon (Very High Disturbance)
- S.Lagoon = South Lagoon (Very Low Disturbance)
- Vaskes = Vaskes Bay (Very Low Disturbance)

This plot is to highlight two facts:
1. There is no data in the latter timepoint from BOW
2. Vaskes Bay appears to "increase" in volume, however we delve into that further in the next plot

```{r change ~ region, echo=FALSE}
ggplot(CC.progress, aes(timepoint, volume.change)) + geom_boxplot(fill="deepskyblue") +facet_wrap(~region, scales = "fixed", ncol= 2) + xlab("Years") + ylab("Volumetric Change(m3)") +  geom_hline(yintercept = 0, linetype="dashed", color="red", size=0.2) #+ geom_label(label= "p=0.0132", x= 2, y=-1.0, label.size= 0.5, label.padding= unit(0.5, "lines"), fill= "grey", color="black")#

```

## Vaskes Bay

- Both site 5 and 37 are located in Vaskes bay is on the southern edge of the atoll (with the other VL sites in the BOW on a more north-eastern facing bay) 

- Only site 5 was sampled in 2015, with site 37 first sampled was 2017

- To investigate whether these two sites are similar I plotted them together (bottom) and only site 5 (top)

- Site 37 evidently experienced more of an increase in habitat volume as it pulls the average volumetric change up (bottom plot)

```{r Vaskess Bay, echo=FALSE}
cc.vask.1 <- ggplot(CC.vaskess5, aes(timepoint, volume.change)) + geom_boxplot(fill="deepskyblue") + xlab("") + ylab("Volumetric Change(m3)") +  geom_hline(yintercept = 0, linetype="dashed", color="red", size=0.2) + ggtitle("Site 5 only") + theme(plot.title = element_text(hjust = 0.5))


cc.vask.2 <- ggplot(CC.vaskess5.37, aes(timepoint, volume.change)) + geom_boxplot(fill="deepskyblue") + xlab("Timepoint") + ylab("Volumetric Change(m3)") +  geom_hline(yintercept = 0, linetype="dashed", color="red", size=0.2) + ggtitle("Site 5 & 37") + theme(plot.title = element_text(hjust = 0.5))

# Plot both together
grid.arrange(cc.vask.1,cc.vask.2, nrow=2)

```

# 2. ArcMap Complexity

#### 2.a Plot size through time

- Plot size had been shown to vary over time in previous exploratory plots

- This issue has been fixed now by copying  previous plot areas in ArcMap and importing them into subsequent years plots before orienting them on consistent stake and benthic topography


```{r plot size, echo=FALSE}
ggplot(mpq, aes(ppq, area_2d, colour = year)) + geom_boxplot() +facet_wrap(~site, scales = "fixed", ncol= 3) + xlab("PPQ") + ylab("Plot 2d Area")+ theme(plot.title = element_text(hjust = 0.5))+ theme(plot.title = element_text(size=22)) + ylim(15, 17)
```

#### 2.b. Fractal Dimension

- For these caluclations, Atsuko's code mentioned calculating log(3d area/2d area), which she says is "to account for changes in area due to raster aggregate function". We didn't use R to aggregate different resolution values, so therefore I decided to just use 3d area. 

- This appears to be the right decision, as Young et al. (2017) did a similar calcualtion and state that "D is between 2 and 3 for a surface, with a greater number indicating greater complexity" 

```{r Fractal Dimension work}
frac <- read.csv("~/Desktop/GitHub/Bruce_MPQ_Analysis/Data/BaumLab_Fractal_Dimension_Data_Clean.csv")

frac
levels(frac$site.ppq)
frac$site.ppq <- as.character(frac$site.ppq)

frac.5 <- subset(frac, site == 5)
frac.15 <- subset(frac, site == 15)

ggplot(frac.5, aes (x= ppq, y= fractal.dimension, color = year)) + geom_point() #+ facet_wrap(~site, scales = "fixed", ncol= 3)

ggplot(frac.15, aes (x= ppq, y= fractal.dimension, color = year)) + geom_point() #+ facet_wrap(~site, scales = "fixed", ncol= 3)


```



# 3 Complexity Metrics ~ Year {.tabset}

-Overarching theme for most metrics: After a large initial declines occurred at the tail end/immediately following the mass mortality event (2016a) and then complexity stayed consistent through time

- All statistical results in this section were computed via ANOVA and TukeyHSD tests (modelling to come)

## 3.1 Surface Complexity

- Significant differences occurred at the 1cm DEM, yet were lost in later DEM resolutions

- At the 1cm, the 2015 timepoint is significantly different from 2016a, 2016b, and 2017 timepoints

```{r Surface Complexity ~ year, echo=FALSE}
# Surface Complexity **Simple Graph
# ggplot(mpq, aes(x = year, y=rug)) + geom_boxplot(fill="deepskyblue") + theme_classic(base_size = 10) +facet_wrap(~DEM, scales = "fixed", ncol= 3)+ xlab("Year") + ylab("Surface complexity") 

####1cm#####
SC.1 <- ggplot(mpq.1, aes(x = year, y=rug)) + geom_boxplot(fill="deepskyblue") + theme_classic(base_size = 10) +facet_wrap(~DEM, scales = "fixed", ncol= 2)+ xlab("Year") + ylab("Surface complexity") + geom_label(label= "p=0.00179", x= 3, y=2.7, label.size= 0.02, label.padding= unit(0.02, "lines"), fill= "grey", color="black") + ylim(0.8, 3)

# Anova at 1cm DEM
# s.complex.1 <- aov(rug~year, data=mpq.1)
# summary(s.complex.1)
# TukeyHSD(s.complex.1)

##### 4cm DEM ####
SC.2<-ggplot(mpq.4, aes(x = year, y=rug)) + geom_boxplot(fill="deepskyblue") + theme_classic(base_size = 10) +facet_wrap(~DEM, scales = "fixed", ncol= 2)+ xlab("Year") + ylab("") + geom_label(label= "p=0.438", x= 3, y=2.7, label.size= 0.02, label.padding= unit(0.02, "lines"), fill= "grey", color="black") + ylim(0.8, 3)

#Anova at 4cm DEM
# s.complex.4 <- aov(rug~year, data=mpq.4)
# summary(s.complex.4)
# TukeyHSD(s.complex.4)

####8cm DEM ####
SC.3 <- ggplot(mpq.8, aes(x = year, y=rug)) + geom_boxplot(fill="deepskyblue") + theme_classic(base_size = 10) +facet_wrap(~DEM, scales = "fixed", ncol= 2)+ xlab("Year") + ylab("") + geom_label(label= "p=0.716", x=3, y=2.7, label.size= 0.02, label.padding= unit(0.02, "lines"), fill= "grey", color="black") + ylim(0.8, 3)

#Anova at 8cm DEM
# s.complex.8 <- aov(rug~year, data=mpq.8)
# summary(s.complex.8)
# TukeyHSD(s.complex.8)

grid.arrange(SC.1, SC.2, SC.3, ncol = 3)

```

## 3.2 Slope

- Initial decline between 2015 and 2016a seen here

- Only significant difference occurs at 1cm DEM between 2015 and 2016a timepoints

```{r Slope ~ Year, echo=FALSE}
# ##1.2 Slope  *SIMPLE GRAPH
# ggplot(mpq, aes(x = year, y=slope)) + geom_boxplot(fill="deepskyblue") + theme_classic(base_size = 10) +facet_wrap(~DEM, scales = "fixed", ncol= 3)+ xlab("Year") + ylab("Slope") 

####1cm#####
Slope.1 <- ggplot(mpq.1, aes(x = year, y=slope)) + geom_boxplot(fill="deepskyblue") + theme_classic(base_size = 10) +facet_wrap(~DEM, scales = "fixed", ncol= 2)+ xlab("Year") + ylab("Slope") + geom_label(label= "p=0.0126", x= 3, y=50, label.size= 0.02, label.padding= unit(0.02, "lines"), fill= "grey", color="black") + ylim(10, 55)

#Anova at 1cm DEM
# slope.1 <- aov(slope~year, data=mpq.1)
# summary(slope.1)
# TukeyHSD(slope.1)

##### 4cm DEM ####
Slope.2<-ggplot(mpq.4, aes(x = year, y=slope)) + geom_boxplot(fill="deepskyblue") + theme_classic(base_size = 10) +facet_wrap(~DEM, scales = "fixed", ncol= 2)+ xlab("Year") + ylab("") + geom_label(label= "p=0.807", x= 3, y=50, label.size= 0.02, label.padding= unit(0.02, "lines"), fill= "grey", color="black") + ylim(10, 55)

#Anova at 4cm DEM
# slope.4 <- aov(slope~year, data=mpq.4)
# summary(slope.4)
# TukeyHSD(slope.4)

####8cm DEM ####
Slope.3 <- ggplot(mpq.8, aes(x = year, y=slope)) + geom_boxplot(fill="deepskyblue") + theme_classic(base_size = 10) +facet_wrap(~DEM, scales = "fixed", ncol= 2)+ xlab("Year") + ylab("") + geom_label(label= "p=0.904", x=3, y=50, label.size= 0.02, label.padding= unit(0.02, "lines"), fill= "grey", color="black") + ylim(10, 55)

#Anova at 8cm DEM
# slope.8 <- aov(slope~year, data=mpq.8)
# summary(slope.8)
# TukeyHSD(slope.8)

grid.arrange(Slope.1, Slope.2, Slope.3, ncol = 3)
```

## 3.3 VRM

- Steep initial decline apparent between 2015 and 2016a timepoints, with 2019 appearing to rebound to similar 2015 levels at 1cm DEM. 

- Above trend is less apparent and/or disappears at larger DEM resolutions

- At 1cm DEM, 2015 timepoint is significantly different from 2016a, 2016b, and 2017 (almost 2019 (P= 0.05397)). 2019 timepoint significantly different from 2016a, 2016b, and 2017.

```{r vrm ~ year, echo=FALSE}
# #1.3. VRM #SIMPLE GRAPH
# ggplot(mpq, aes(x = year, y=vrm)) + geom_boxplot(fill="deepskyblue") + theme_classic(base_size = 10) +facet_wrap(~DEM, scales = "fixed", ncol= 3)+ xlab("Year") + ylab("VRM") 

####1cm#####
VRM.1 <- ggplot(mpq.1, aes(x = year, y=vrm)) + geom_boxplot(fill="deepskyblue") + theme_classic(base_size = 10) +facet_wrap(~DEM, scales = "fixed", ncol= 2)+ xlab("Year") + ylab("VRM") + geom_label(label= "p=2.81E-10", x= 4, y=0.120, label.size= 0.02, label.padding= unit(0.02, "lines"), fill= "grey", color="black") + ylim(0.02, 0.12)

#For Grad Symposium Slide

mpq.1.grad <- mpq.1
str(mpq.1.grad$year)
mpq.1.grad$year <- as.character(mpq.1.grad$year)

#Change Years to time
for(i in c(1:nrow(mpq.1.grad))) {
  if(mpq.1.grad$year[i]=="2015") {
    mpq.1.grad$year[i] <- "July 2015"
  } else if(mpq.1.grad$year[i]=="2016a") {
    mpq.1.grad$year[i] <- "March 2016"
  } else if(mpq.1.grad$year[i]=="2016b") {
    mpq.1.grad$year[i] <- "November 2016"
  } else if(mpq.1.grad$year[i]=="2017") {
    mpq.1.grad$year[i] <- "July 2017"
  } else if(mpq.1.grad$year[i]=="2019") {
   mpq.1.grad$year[i] <- "July 2019"
  }}

levels(mpq.1.grad$year)
mpq.1.grad$year <- factor(mpq.1.grad$year, levels = c("July 2015", "March 2016", "November 2016", "July 2017", "July 2019"))



VRM.1 <- ggplot(mpq.1.grad, aes(x = year, y=vrm)) + geom_boxplot(fill="steelblue3") + theme_classic(base_size = 18) + xlab("Year") + ylab("Vector Ruggedness Measure (VRM)") + ylim(0.02, 0.12)  + annotate("text", x=5, y=0.12, label= "p=2.81E-10", size = 7) + annotate("text", x= 1, y=0.115, label= "A", size = 6) + annotate("text", x= 2, y=0.095, label= "B", size = 6) + annotate("text", x= 3, y=0.095, label= "B", size = 6) + annotate("text", x= 4, y=0.095, label= "B", size = 6) + annotate("text", x= 5, y=0.095, label= "AB", size = 6) 


 
VRM.1
#Anova at 1cm DEM
# vrm.1 <- aov(vrm~year, data=mpq.1)
# summary(vrm.1)
# TukeyHSD(vrm.1)

##### 4cm DEM ####
VRM.2<-ggplot(mpq.4, aes(x = year, y=vrm)) + geom_boxplot(fill="deepskyblue") + theme_classic(base_size = 10) +facet_wrap(~DEM, scales = "fixed", ncol= 2)+ xlab("Year") + ylab("") + geom_label(label= "p=0.0958", x= 3, y=0.120, label.size= 0.02, label.padding= unit(0.02, "lines"), fill= "grey", color="black") + ylim(0.02, 0.12)

#Anova at 4cm DEM
# vrm.4 <- aov(vrm~year, data=mpq.4)
# summary(vrm.4)
# TukeyHSD(vrm.4)

####8cm DEM ####
VRM.3 <- ggplot(mpq.8, aes(x = year, y=vrm)) + geom_boxplot(fill="deepskyblue") + theme_classic(base_size = 10) +facet_wrap(~DEM, scales = "fixed", ncol= 2)+ xlab("Year") + ylab("") + geom_label(label= "p=0.904", x=3, y=0.120, label.size= 0.02, label.padding= unit(0.02, "lines"), fill= "grey", color="black") + ylim(0.02, 0.12)

#Anova at 8cm DEM
# vrm.8 <- aov(slope~year, data=mpq.8)
# summary(vrm.8)
# TukeyHSD(vrm.8)

grid.arrange(VRM.1, VRM.2, VRM.3, ncol = 3)

```

## 3.4 Profile Curvature

- Trend of profile curvature shifting from more negative towards more positive values through time, indicating shifts in structure orientation to more inwardly concave (positive pro.curv values).

- I hypothesis this is due to erosion, as profile curvature deals with the orientation at the point of maximum slope and therefore that is where I believe the flow of water and eroded debris would be moving the strongest. 

- Magnitude differs across resolutions, but the trend appears to stay consistent across DEM resolutions. 


```{r pro curv ~ year, echo=FALSE}
# #1.4 Profile Curvature **SIMPLE GRAPH
# ggplot(mpq, aes(x = year, y=pro.curv)) + geom_boxplot(fill="deepskyblue") + theme_classic(base_size = 10) +facet_wrap(~DEM, scales = "fixed", ncol= 3)+ xlab("Year") + ylab("Profile Curvature") 

####1cm#####
pro.curv.1 <- ggplot(mpq.1, aes(x = year, y=pro.curv)) + geom_boxplot(fill="deepskyblue") + theme_classic(base_size = 10) +facet_wrap(~DEM, scales = "fixed", ncol= 2)+ xlab("Year") + ylab("Profile Curvature") + geom_label(label= "p=8.04E-6", x= 3, y=400, label.size= 0.02, label.padding= unit(0.02, "lines"), fill= "grey", color="black") + ylim(-450, 450)

#Anova at 1cm DEM
# pcur.1 <- aov(pro.curv~year, data=mpq.1)
# summary(pcur.1)
# TukeyHSD(pcur.1)

##### 4cm DEM ####
pro.curv.4<-ggplot(mpq.4, aes(x = year, y=pro.curv)) + geom_boxplot(fill="deepskyblue") + theme_classic(base_size = 10) +facet_wrap(~DEM, scales = "fixed", ncol= 2)+ xlab("Year") + ylab("") + geom_label(label= "p=0.047", x= 3, y=400, label.size= 0.02, label.padding= unit(0.02, "lines"), fill= "grey", color="black") + ylim(-450, 450)

#Anova at 4cm DEM
# p.curv.4 <- aov(pro.curv~year, data=mpq.4)
# summary(p.curv.4)
# TukeyHSD(p.curv.4)

####8cm DEM ####
pro.curv.8 <- ggplot(mpq.8, aes(x = year, y=pro.curv)) + geom_boxplot(fill="deepskyblue") + theme_classic(base_size = 10) +facet_wrap(~DEM, scales = "fixed", ncol= 2)+ xlab("Year") + ylab("") + geom_label(label= "p=0.304", x=3, y=400, label.size= 0.02, label.padding= unit(0.02, "lines"), fill= "grey", color="black") + ylim(-450, 450)

#Anova at 8cm DEM
# p.curv.8 <- aov(pro.curv~year, data=mpq.8)
# summary(p.curv.8)
# TukeyHSD(p.curv.8)

grid.arrange(pro.curv.1, pro.curv.4, pro.curv.8, ncol = 3)
```

## 3.5 Planform Curvature

- Similar to profile curvature, planform curvature values move towards more positive values as we progress through time, indicating the structure's orientation perpendicular to the maximum slope is becoming more outwardly convex. 

- This could again be due to erosion forces, as these heavily erode the face of the maximum slope, thereby leaving lips or ridges directly perpendicular to the flow.

- Again, this trend is present across DEM resolutions.

```{r plan curv, echo=FALSE}
# #1.5 Planform Curvature simple plot
# ggplot(mpq, aes(x = year, y=plan.curv)) + geom_boxplot(fill="deepskyblue") + theme_classic(base_size = 10) +facet_wrap(~DEM, scales = "fixed", ncol= 3)+ xlab("Year") + ylab("Planform Curvature") 

####1cm#####
plan.curv.1 <- ggplot(mpq.1, aes(x = year, y=plan.curv)) + geom_boxplot(fill="deepskyblue") + theme_classic(base_size = 10) +facet_wrap(~DEM, scales = "fixed", ncol= 2)+ xlab("Year") + ylab("Planform Curvature") + geom_label(label= "p=7.08E-6", x= 3, y=400, label.size= 0.02, label.padding= unit(0.02, "lines"), fill= "grey", color="black") + ylim(-450, 450)

#Anova at 1cm DEM
# planc.1 <- aov(plan.curv~year, data=mpq.1)
# summary(planc.1)
# TukeyHSD(planc.1)

##### 4cm DEM ####
plan.curv.4<-ggplot(mpq.4, aes(x = year, y=plan.curv)) + geom_boxplot(fill="deepskyblue") + theme_classic(base_size = 10) +facet_wrap(~DEM, scales = "fixed", ncol= 2)+ xlab("Year") + ylab("") + geom_label(label= "p=0.025", x= 3, y=400, label.size= 0.02, label.padding= unit(0.02, "lines"), fill= "grey", color="black") + ylim(-450, 450)

#Anova at 4cm DEM
# planc.4 <- aov(plan.curv~year, data=mpq.4)
# summary(planc.4)
# TukeyHSD(planc.4)

####8cm DEM ####
plan.curv.8 <- ggplot(mpq.8, aes(x = year, y=pro.curv)) + geom_boxplot(fill="deepskyblue") + theme_classic(base_size = 10) +facet_wrap(~DEM, scales = "fixed", ncol= 2)+ xlab("Year") + ylab("") + geom_label(label= "p=0.304", x=3, y=400, label.size= 0.02, label.padding= unit(0.02, "lines"), fill= "grey", color="black") + ylim(-450, 450)

#Anova at 8cm DEM
# p.curv.8 <- aov(pro.curv~year, data=mpq.8)
# summary(p.curv.8)
# TukeyHSD(p.curv.8)

grid.arrange(plan.curv.1, plan.curv.4, plan.curv.8, ncol = 3)
```

# 4. Complexity Metrics Across the Human Disturbance gradient {.tabset}

- This section highlights variability across the disturbance gradient, with very low disturbance sites having higher values across metrics than medium and very low disturbance sites (not statistically tested yet)

- Again, look for the steep decline between 2015 and 2016a timepoints before complexity "stagnates" for the remainder of the study (slight to moderate increases in 2019 are seen in some metrics)

## 4.1 Surface Complexity ~ Human Disturbance

- All disturbance levels experienced their largest declines between 2015 and 2016a, with Very Low sites experiencing the largest losses.

```{r SC~hum_dist, echo=FALSE}
#2.1 Surface Complexity 
ggplot(mpq, aes(x= year, y= rug, fill=hum_dist)) +  geom_boxplot() + xlab("Year") + ylab("Surface Complexity") +facet_wrap(~DEM, scales = "fixed", ncol= 3) 

```

## 4.2 Slope ~ Human Disturbance

- Similar results to Surface Complexity.

```{r Slope~hum_dist, echo=FALSE}
#2.2 Slope
ggplot(mpq, aes(x= year, y= slope, fill=hum_dist)) +  geom_boxplot() + xlab("Year") + ylab("Slope") +facet_wrap(~DEM, scales = "fixed", ncol= 3) 
```


## 4.3 VRM ~ Human Disturbance

- Those initial losses at all disturbance levels are more pronounced with VRM than any other metric

```{r VRM~hum_dist, echo=FALSE}
#2.3 VRM
ggplot(mpq, aes(x= year, y= vrm, fill=hum_dist)) +  geom_boxplot() + xlab("Year") + ylab("VRM") +facet_wrap(~DEM, scales = "fixed", ncol= 3) 

```


## 4.4 Profile Curvature ~ Human Disturbance

- Large increases are seen in that first timepoint shift (2015-2016a) at very low sites, with moderate increases seen in Medium sites and little change in Very Low sites

- Again, this indicates a change in orientation of structure parallel to the maximum slope that persists throughout the study.

```{r Pro.Curv~hum-dist, echo=FALSE}
#2.4 Profile Curvature
ggplot(mpq, aes(x= year, y= pro.curv, fill=hum_dist)) +  geom_boxplot() + xlab("Year") + ylab("Profile Curvature") +facet_wrap(~DEM, scales = "fixed", ncol= 3) 

```

## 4.5 Planform Curvature ~ Human Disturbance

- Similar results to profile curvature

- Change in orientation of structure perpendicular to maximum slope seen across disturbance levels, although is most pronounced at Very Low sites, which are likely driving the overall trend reported earlier.

```{r Plan.curv~hum_dist, echo=FALSE}
#2.5 Planform Curvature
ggplot(mpq, aes(x= year, y= plan.curv, fill=hum_dist)) +  geom_boxplot() + xlab("Year") + ylab("Planform Curvature") +facet_wrap(~DEM, scales = "fixed", ncol= 3) 

```

# 5. Complexity Metrics by geographic region {.tabset}

- This section is to highlight differences between the regions that make up the Very Low disturbance level: Bay of Wrecks & Vaskes Bay.

- Overall, Bay of Wrecks was more structurally complex than the Vaskes Bay sites.

- When looking at certain metrics (ex: VRM) it appears Vaskes Bay sites are more similar structurally to the Medium disturbance sites than to the BOW sites after the El Nino.

- I believe this is due to the different coral communities present at the two sites, so this will be worth looking at in more detail with the morphological digitization work. 

## 5.1 Surface Complexity ~ Region
```{r SC ~ region, echo=FALSE}
ggplot(mpq, aes(x= year, y= rug, fill=region)) +  geom_boxplot() + xlab("Year") + ylab("Surface Complexity") +facet_wrap(~DEM, scales = "fixed", ncol= 3)
```

## 5.2 Slope ~ Region
```{r Slope~region, echo=FALSE}
ggplot(mpq, aes(x= year, y= slope, fill=region)) +  geom_boxplot() + xlab("Year") + ylab("Slope") +facet_wrap(~DEM, scales = "fixed", ncol= 3)
```

## 5.3 VRM ~ Region
```{r VRM~Region, echo=FALSE}
ggplot(mpq, aes(x= year, y= vrm, fill=region)) +  geom_boxplot() + xlab("Year") + ylab("VRM") +facet_wrap(~DEM, scales = "fixed", ncol= 3)

```

## 5.4 Profile Curvature ~ Region
```{r Pro.Curv~Region, echo=FALSE}
ggplot(mpq, aes(x= year, y= pro.curv, fill=region)) +  geom_boxplot() + xlab("Year") + ylab("Profile Curvature") +facet_wrap(~DEM, scales = "fixed", ncol= 3)

```

## 5.5 Planform Curvature ~ Region

```{r Plan.Curv~Region, echo=FALSE}
ggplot(mpq, aes(x= year, y= plan.curv, fill=region)) +  geom_boxplot() + xlab("Year") + ylab("Planform Curvature") +facet_wrap(~DEM, scales = "fixed", ncol= 3)
```


# 6. ArcMap Digitization {.tabset}

```{r Digitization code prep for plots, include=FALSE}
#Change the structure in some of the 
str(dig)
dig$year <- as.character(dig$year)

#Check the levels of how the sites show up on the barchart 
levels(as.factor(dig$year.site.ppq))

#Correct levels for how the morphologies will show up on the graph (first ones listed will be the bars stacked on the top)
dig$year.site.ppq <- factor(dig$year.site.ppq, levels=c("2015.5.1","2015.5.2","2015.5.3","2015.15.1","2015.15.2","2015.15.3","2015.19.1","2015.19.2", "2015.8.1", "2015.8.2", "2015.8.3", "2015.34.1","2015.34.2","2015.34.3","2015.35.1","2015.35.2","2015.35.3", "2015.27.1", "2015.27.2", "2015.27.3", "2015.30.1", "2015.30.2", "2015.30.3", "2015.32.1", "2015.32.2", "2015.32.3","2017.5.1","2017.5.2","2017.5.3","2017.15.1","2017.15.2","2017.15.3","2017.19.1","2017.19.2","2017.19.3", "2017.37.1","2017.37.2","2017.37.3", "2017.8.1", "2017.8.2", "2017.8.3", "2017.34.1","2017.34.2","2017.34.3","2017.35.1","2017.35.2", "2017.27.1", "2017.27.2", "2017.27.3", "2017.30.1", "2017.30.2", "2017.32.2", "2019.5.1","2019.5.2","2019.5.3", "2019.37.1","2019.37.2","2019.37.3", "2019.8.1", "2019.8.2", "2019.8.3", "2019.34.1","2019.34.2","2019.34.3","2019.35.1","2019.35.2","2019.35.3", "2019.27.1", "2019.27.2", "2019.27.3", "2019.30.1", "2019.30.2", "2019.30.3", "2019.32.1", "2019.32.2", "2019.32.3"))

**** something in above code is causing an NA collumn to show up. Also might be worthwhile clustering site 5 at end of VL group, so that it is next to Site 37 in 2017 and 2019 (regional changes can show up then too)

# #Use the below code once all the sites are included in the 2019 dataframe (once all plots are digitized and uploaded)
# dig$year.site.ppq <- factor(dig$year.site.ppq, levels=c("2015.5.1","2015.5.2","2015.15.3","2015.15.1","2015.15.2","2015.15.3","2015.19.1","2015.19.2", "2015.8.1", "2015.8.2", "2015.8.3", "2015.34.1","2015.34.2","2015.34.3","2015.35.1","2015.35.2","2015.35.3", "2015.27.1", "2015.27.2", "2015.27.3", "2015.30.1", "2015.30.2", "2015.30.3", "2015.32.1", "2015.32.2", "2015.32.3","2017.5.1","2017.5.2","2017.15.3","2017.15.1","2017.15.2","2017.15.3","2017.19.1","2017.19.2","2017.19.3", "2017.37.1","2017.37.2","2017.37.3", "2017.8.1", "2017.8.2", "2017.8.3", "2017.34.1","2017.34.2","2017.34.3","2017.35.1","2017.35.2","2017.35.3", 2017.27.1", "2017.27.2", "2017.27.3", "2017.30.1", "2017.30.2", "2017.30.3", "2017.32.1", "2017.32.2", "2017.32.3","2019.5.1","2019.5.2","2019.15.3", "2019.37.1","2019.37.2","2019.37.3", "2019.8.1", "2019.8.2", "2019.8.3", "2019.34.1","2019.34.2","2019.34.3","2019.35.1","2019.35.2","2019.35.3", "2019.27.1", "2019.27.2", "2019.27.3", "2019.30.1", "2019.30.2", "2019.30.3", "2019.32.1", "2019.32.2", "2019.32.3"))



#Check the levels of how the bars will show up on the stacked barchart
levels(as.factor(dig$Benthic_Morphology))

#Correct levels for how the morphologies will show up on the graph (first ones listed will be the bars stacked on the top)
dig$Benthic_Morphology <- factor(dig$Benthic_Morphology, levels=c("Sand", "Rubble", "Dead_SoftCoral", "Dead_Tabulate", "Dead_Massive", "Dead_Foliose","Dead_Columnar","Dead_Branching", "Macroalgae", "NonCoral_SubMassive", "NonCoral_Massive", "NonCoral_Encrusting", "NonCoral_Branching", "SoftCoral_Plating", "SoftCoral_Nodular", "Live_Tabulate", "Live_SubMassive", "Live_Porites", "Live_Massive_Grooved", "Live_Massive", "Live_FreeLiving", "Live_Foliose", "Live_Encrusting_Columnar", "Live_Encrusting", "Live_Digitate", "Live_Columnar","Live_Branching"))

##<------Set Colour Pallettes for each morphology type ----->
morph.cols <- rev(c("seagreen3", "Medium Spring Green", "Chartreuse", "Forest Green", "Spring Green","palegreen2", "mediumseagreen", "darkseagreen3", "Yellow Green", "Green Yellow", "Light Green", "Orchid", "Pale Violet Red", "Cyan", "Dark Turquoise", "Deep Sky Blue", "Dodger Blue", "Dark Blue","Gray80", "Gray75", "Gray70","Gray65","Gray60","Gray55", "Gray30", "Gray25"))
morph.colscale<- scale_fill_manual(name="", values=morph.cols, breaks=rev(c("Live_Branching", "Live_Columnar", "Live_Digitate", "Live_Encrusting", "Live_Encrusting_Columnar", "Live_Foliose", "Live_FreeLiving", "Live_Massive", "Live_Massive_Grooved", "Live_Porites", "Live_SubMassive", "Live_Tabulate", "SoftCoral_Nodular", "SoftCoral_Plating", "NonCoral_Branching", "NonCoral_Encrusting", "NonCoral_Massive", "NonCoral_SubMassive", "Macroalgae", "Dead_Branching", "Dead_Columnar", "Dead_Foliose", "Dead_Massive", "Dead_Tabulate", "Dead_SoftCoral", "Rubble", "Sand")))

#% Coverage
ggplot(dig, aes(y=percent.coverage, x=year.site.ppq, fill= Benthic_Morphology)) + geom_bar(stat = 'identity', position = 'stack') + morph.colscale +theme(axis.text.x = element_text(angle = 270, vjust = 0.5, hjust=1) +  geom_vline(xintercept = 20.5, linetype="dashed", color="black", size=0.5)) + geom_vline(xintercept = 56.5, linetype="dashed", color="red", size=0.5) + geom_vline(xintercept = 26.5, linetype="dashed", color="red", size=0.5)+theme(axis.text.x = element_text(angle = 270, vjust = 0.5, hjust=1)) + xlab("Year-Site-PPQ") + ylab("Percent Cover")

#Colony Count
ggplot(dig, aes(y=colony.count, x=year.site.ppq, fill= Benthic_Morphology)) + geom_bar(stat = 'identity', position = 'stack') + morph.colscale +theme(axis.text.x = element_text(angle = 270, vjust = 0.5, hjust=1) +  geom_vline(xintercept = 20.5, linetype="dashed", color="black", size=0.5)) + geom_vline(xintercept = 56.5, linetype="dashed", color="red", size=0.5) + geom_vline(xintercept = 26.5, linetype="dashed", color="red", size=0.5)+theme(axis.text.x = element_text(angle = 270, vjust = 0.5, hjust=1)) + xlab("Year-Site-PPQ") + ylab("Colony Count")



#############################################################################################################################
###### TEMPORARY PLOT FOR MEETING WITH JB ####
#############################################################################################################################

#dataframe to use
dig_percent

#Re-Structure bar charts
#dig_percent$Benthic_Morphology <- factor(dig_percent$Benthic_Morphology, levels= rev(c("Live_Branching", "Live_Columnar", "Live_Digitate", "Live_Encrusting", "Live_Encrusting_Columnar", "Live_Foliose", "Live_FreeLiving", "Live_Massive", "Live_Massive_Grooved", "Live_Porites", "Live_SubMassive", "Live_Tabulate", "SoftCoral_Nodular", "SoftCoral_Plating", "NonCoral_Branching", "NonCoral_Encrusting", "NonCoral_Massive", "NonCoral_SubMassive", "Macroalgae", "Dead_Branching", "Dead_Columnar", "Dead_Foliose", "Dead_Massive", "Dead_Tabulate", "Dead_SoftCoral", "Rubble", "Sand")))
   
dig$Benthic_Morphology <- factor(dig$Benthic_Morphology, levels=c("Sand", "Rubble", "Dead_SoftCoral", "Dead_Tabulate", "Dead_Massive", "Dead_Foliose","Dead_Columnar","Dead_Branching", "Macroalgae", "NonCoral_SubMassive", "NonCoral_Massive", "NonCoral_Encrusting", "NonCoral_Branching", "SoftCoral_Plating", "SoftCoral_Nodular", "Live_Tabulate", "Live_SubMassive", "Live_Porites", "Live_Massive_Grooved", "Live_Massive", "Live_FreeLiving", "Live_Foliose", "Live_Encrusting_Columnar", "Live_Encrusting", "Live_Digitate", "Live_Columnar","Live_Branching"))
                                     
#<------Set Colour Pallettes for each morphology type ----->
morph.cols <- rev(c("seagreen3", "Medium Spring Green", "Chartreuse", "Forest Green", "Spring Green","palegreen2", "mediumseagreen", "darkseagreen3", "Yellow Green", "Green Yellow", "Light Green", "Orchid", "Pale Violet Red", "Cyan", "Dark Turquoise", "Deep Sky Blue", "Dodger Blue", "Dark Blue","Gray80", "Gray75", "Gray70","Gray65","Gray60","Gray55", "Gray30", "Gray25"))
morph.colscale<- scale_fill_manual(name="", values=morph.cols, breaks=rev(c("Live_Branching", "Live_Columnar", "Live_Digitate", "Live_Encrusting", "Live_Encrusting_Columnar", "Live_Foliose", "Live_FreeLiving", "Live_Massive", "Live_Massive_Grooved", "Live_Porites", "Live_SubMassive", "Live_Tabulate", "SoftCoral_Nodular", "SoftCoral_Plating", "NonCoral_Branching", "NonCoral_Encrusting", "NonCoral_Massive", "NonCoral_SubMassive", "Macroalgae", "Dead_Branching", "Dead_Columnar", "Dead_Foliose", "Dead_Massive", "Dead_Tabulate", "Dead_SoftCoral", "Rubble", "Sand")))

#% Coverage
ggplot(dig_percent, aes(y=coverage, x=year.site.ppq, fill= Benthic_Morphology)) + geom_bar(stat = 'identity', position = 'stack') + morph.colscale +theme(axis.text.x = element_text(angle = 270, vjust = 0.5, hjust=1) +  geom_vline(xintercept = 20.5, linetype="dashed", color="black", size=0.5)) + geom_vline(xintercept = 56.5, linetype="dashed", color="red", size=0.5) + geom_vline(xintercept = 26.5, linetype="dashed", color="red", size=0.5)+theme(axis.text.x = element_text(angle = 270, vjust = 0.5, hjust=1)) + xlab("Year-Site-PPQ") + ylab("Percent Cover")

#Subset a few sites just to get some plots for the prezzy
#Site 5
dig_s5 <- subset (dig_percent, site == 5)

#Create unique color scheme for site 5 to match with site 8
morph.cols_s5 <- rev(c("seagreen3", "Medium Spring Green", "Chartreuse", "Forest Green", "Spring Green","palegreen2", "mediumseagreen", "darkseagreen3", "Yellow Green","Light Green", "Orchid", "Pale Violet Red", "Deep Sky Blue", "Dodger Blue", "Dark Blue","Gray80", "Gray75", "Gray70","Gray65","Gray60","Gray55", "Gray30", "Gray25"))
morph.colscale_s5<- scale_fill_manual(name="", values=morph.cols_s5, breaks=rev(c("Live_Branching", "Live_Columnar", "Live_Digitate", "Live_Encrusting", "Live_Foliose", "Live_FreeLiving", "Live_Massive", "Live_Massive_Grooved", "Live_Porites", "Live_SubMassive", "SoftCoral_Nodular", "SoftCoral_Plating", "NonCoral_Massive", "NonCoral_SubMassive", "Macroalgae", "Dead_Branching", "Dead_Columnar", "Dead_Foliose", "Dead_Massive", "Dead_Tabulate", "Dead_SoftCoral", "Rubble", "Sand")))

morph1 <- ggplot(dig_s5, aes(fill=Benthic_Morphology, y=coverage, x=ppq)) + geom_bar(stat = 'identity', position = 'stack') +facet_wrap(~year, scales = "fixed", ncol= 3)+ morph.colscale_s5+ xlab("Year-Site-PPQ") + ylab("Percent Cover") + scale_y_continuous(breaks = scales::pretty_breaks(n = 10))#ggplot(dig_s5, aes(y=coverage, x=year.site.ppq, fill= Benthic_Morphology)) + geom_bar(stat = 'identity', position = 'stack') + morph.colscale +theme(axis.text.x = element_text(angle = 270, vjust = 0.5, hjust=1) +  geom_vline(xintercept = 20.5, linetype="dashed", color="black", size=0.5)) + geom_vline(xintercept = 56.5, linetype="dashed", color="red", size=0.5) + geom_vline(xintercept = 26.5, linetype="dashed", color="red", size=0.5)+theme(axis.text.x = element_text(angle = 270, vjust = 0.5, hjust=1)) + xlab("Year-Site-PPQ") + ylab("Percent Cover")
morph1

###Site 8
dig_s8 <- subset (dig_percent, site == 8)

#Create unique colour scale for site 8
morph.cols_s8 <- rev(c("seagreen3", "Medium Spring Green", "Chartreuse", "Forest Green", "Spring Green","palegreen2", "mediumseagreen", "darkseagreen3", "Green Yellow", "Light Green", "Orchid", "Pale Violet Red", "Cyan", "Dark Turquoise", "Deep Sky Blue", "Dodger Blue", "Dark Blue","Gray75", "Gray70","Gray65","Gray60","Gray55", "Gray30", "Gray25"))

morph.colscale_s8<- scale_fill_manual(name="", values=morph.cols_s8, breaks=rev(c("Live_Branching", "Live_Columnar", "Live_Digitate", "Live_Encrusting", "Live_Foliose", "Live_FreeLiving", "Live_Massive", "Live_Massive_Grooved", "Live_Porites", "Live_SubMassive", "SoftCoral_Nodular", "SoftCoral_Plating", "NonCoral_Encrusting", "NonCoral_Massive", "NonCoral_SubMassive", "Macroalgae", "Dead_Branching", "Dead_Columnar", "Dead_Foliose", "Dead_Massive", "Dead_Tabulate", "Rubble", "Sand")))


morph2<- ggplot(dig_s8, aes(fill=Benthic_Morphology, y=coverage, x=ppq)) + geom_bar(stat = 'identity', position = 'stack') +facet_wrap(~year, scales = "fixed", ncol= 3)+ morph.colscale_s8 + xlab("Year-Site-PPQ") + ylab("Percent Cover") + scale_y_continuous(breaks = scales::pretty_breaks(n = 10))#+theme(axis.text.x = element_text(angle = 270, vjust = 0.5, hjust=1) +  geom_vline(xintercept = 20.5, linetype="dashed", color="black", size=0.5)) + geom_vline(xintercept = 56.5, linetype="dashed", color="red", size=0.5) + geom_vline(xintercept = 26.5, linetype="dashed", color="red", size=0.5)+theme(axis.text.x = element_text(angle = 270, vjust = 0.5, hjust=1)) 
morph2

### Site 27
dig_s27 <- subset (dig_percent, site == 27)

morph3 <-ggplot(dig_s27, aes(fill=Benthic_Morphology, y=coverage, x=ppq)) + geom_bar(stat = 'identity', position = 'stack') +facet_wrap(~year, scales = "fixed", ncol= 3)+ morph.colscale+ xlab("Year-Site-PPQ") + ylab("Percent Cover") + scale_y_continuous(breaks = scales::pretty_breaks(n = 10))


morph3



#############################################################################################################################

#Prepping dataframe for proper coloration of stacked bars
#Re-Structure bar charts
dig$Benthic_Morphology <- factor(dig$Benthic_Morphology, levels= c("Live_Branching", "Live_Columnar", "Live_Digitate", "Live_Encrusting", "Live_Encrusting_Columnar", "Live_Foliose", "Live_FreeLiving", "Live_Massive", "Live_Massive_Grooved", "Live_Porites", "Live_SubMassive", "Live_Tabulate", "SoftCoral_Nodular", "SoftCoral_Plating", "NonCoral_Branching", "NonCoral_Encrusting", "NonCoral_Massive", "NonCoral_SubMassive", "Macroalgae", "Dead_Branching", "Dead_Columnar", "Dead_Foliose", "Dead_Massive", "Dead_Tabulate", "Dead_SoftCoral", "Rubble", "Sand"))
                                        
#<------Set Colour Pallettes for each morphology type ----->
morph.cols <- c("seagreen3", "Medium Spring Green", "Chartreuse", "Forest Green", "Spring Green","palegreen2", "mediumseagreen", "darkseagreen3", "Yellow Green", "Green Yellow", "Light Green", "Orchid", "Pale Violet Red", "Cyan", "Dark Turquoise", "Deep Sky Blue", "Dodger Blue", "Dark Blue","Gray80", "Gray75", "Gray70","Gray65","Gray60","Gray55", "Wheat", "Sandy Brown")
morph.colscale<- scale_fill_manual(name="", values=morph.cols, breaks=rev(c("Live_Branching", "Live_Columnar", "Live_Digitate", "Live_Encrusting", "Live_Encrusting_Columnar", "Live_Foliose", "Live_FreeLiving", "Live_Massive", "Live_Massive_Grooved", "Live_Porites", "Live_SubMassive", "Live_Tabulate", "SoftCoral_Nodular", "SoftCoral_Plating", "NonCoral_Branching", "NonCoral_Encrusting", "NonCoral_Massive", "NonCoral_SubMassive", "Macroalgae", "Dead_Branching", "Dead_Columnar", "Dead_Foliose", "Dead_Massive", "Dead_Tabulate", "Dead_SoftCoral", "Rubble", "Sand")))

ggplot(dig, aes(y=colony.count, x=year.site.ppq, fill= Benthic_Morphology)) + geom_bar(stat = 'identity', position = 'stack') + morph.colscale +theme(axis.text.x = element_text(angle = 270, vjust = 0.5, hjust=1) +  geom_vline(xintercept = 26.5, linetype="dashed", color="black", size=0.5)) + geom_vline(xintercept = 45.5, linetype="dashed", color="black", size=0.5) + geom_vline(xintercept = 32.5, linetype="dashed", color="black", size=0.5)#+ scale_color_manual(values = c("Dead_Branching" = "grey69", "Dead_Columnar" = "grey68", "Dead_Foliose" ="grey67", "Dead_Massive"="grey66", "Dead_Tabulate"="grey65", "Dead_SoftCoral"="grey40", "Rubble"= "grey30", "Sand"="grey20"))

#% Coverage
ggplot(dig, aes(y=coverage, x=year.site.ppq, fill= Benthic_Morphology)) + geom_bar(stat = 'identity', position = 'stack') + morph.colscale +theme(axis.text.x = element_text(angle = 270, vjust = 0.5, hjust=1) +  geom_vline(xintercept = 26.5, linetype="dashed", color="black", size=0.5)) + geom_vline(xintercept = 45.5, linetype="dashed", color="black", size=0.5) + geom_vline(xintercept = 32.5, linetype="dashed", color="black", size=0.5)

```


## 6.1. # of colonies
```{r Colony counts}
ggplot(dig, aes(fill=Benthic_Morphology, y=colony.count, x=year)) + geom_bar(stat = 'identity', position = 'stack') +theme(axis.text.x = element_text(angle = 270, vjust = 0.5, hjust=1))



```

```{r subsetting digitization data for julia pres,}
# dig_sum
# 
# #Check the levels of how the bars will show up on the stacked barchart
# levels(as.factor(dig_sum$Benthic_Morphology))
# 
# #Re-Structure bar charts
# dig_sum$Benthic_Morphology <- factor(dig_sum$Benthic_Morphology, levels= c("Live_Branching", "Live_Columnar", "Live_Digitate", "Live_Encrusting", "Live_Encrusting_Columnar", "Live_Foliose", "Live_FreeLiving", "Live_Massive", "Live_Massive_Grooved", "Live_Porites", "Live_SubMassive", "Live_Tabulate", "SoftCoral_Nodular", "SoftCoral_Plating", "NonCoral_Branching", "NonCoral_Encrusting", "NonCoral_Massive", "NonCoral_SubMassive", "Macroalgae", "Dead_Branching", "Dead_Columnar", "Dead_Foliose", "Dead_Massive", "Dead_Tabulate", "Dead_SoftCoral", "Rubble", "Sand"))
#                                         
# 
# p1 <- ggplot(dig_sum, aes(y=Per_Area, x=year.site.ppq, fill= Benthic_Morphology)) + geom_bar(stat = 'identity', position = 'stack') + morph.colscale +theme(axis.text.x = element_text(angle = 270, vjust = 0.5, hjust=1) +  geom_vline(xintercept = 26.5, linetype="dashed", color="black", size=0.5)) + geom_vline(xintercept = 45.5, linetype="dashed", color="black", size=0.5) + geom_vline(xintercept = 32.5, linetype="dashed", color="black", size=0.5)+ scale_color_manual(values = c("Dead_Branching" = "grey69", "Dead_Columnar" = "grey68", "Dead_Foliose" ="grey67", "Dead_Massive"="grey66", "Dead_Tabulate"="grey65", "Dead_SoftCoral"="grey40", "Rubble"= "grey30", "Sand"="grey20"))
# p1
# 
# 
# 
# 
# 
# 
# # Practise graph with all completed plots
# p1 <- ggplot(dig_sum, aes(y=Per_Area, x=year.site.ppq, fill= Benthic_Morphology)) + geom_bar(stat = 'identity', position = 'stack') +theme(axis.text.x = element_text(angle = 270, vjust = 0.5, hjust=1) +  geom_vline(xintercept = 26.5, linetype="dashed", color="black", size=0.5)) + geom_vline(xintercept = 45.5, linetype="dashed", color="black", size=0.5) + geom_vline(xintercept = 32.5, linetype="dashed", color="black", size=0.5)
#                                 
# p1
# 
# 
# 
# ####Subset huge dataframe into single site, 1 from each level of disturbance
# #Site 5
# dig_s5 <- subset (dig_sum, site == 5)
# 
# # #Make it only for 2015 and 2019
# # dig_s5 <- subset(dig_s5, year == 2015 | year == 2019) 
# 
# morph1 <- ggplot(dig_s5, aes(fill=Benthic_Morphology, y=Per_Area, x=ppq)) + geom_bar(stat = 'identity', position = 'stack') +facet_wrap(~year, scales = "fixed", ncol= 3) + ylab("Site 5 % Coverage") + xlab("PPQ") #+theme(axis.text.x = element_text(angle = 270, vjust = 0.5, hjust=1)) 
# morph1
# 
# ###Site 8
# dig_s8 <- subset (dig_sum, site == 8)
# 
# #Make it only for 2015 and 2019
# #dig_s8 <- subset(dig_s8, year == 2015 | year == 2019) 
# 
# morph2<- ggplot(dig_s8, aes(fill=Benthic_Morphology, y=Per_Area, x=ppq)) + geom_bar(stat = 'identity', position = 'stack') +facet_wrap(~year, scales = "fixed", ncol= 3)+ ylab("Site 8 % Coverage") + xlab("PPQ")
# morph2 
# 
# ### Site 27
# dig_s27 <- subset (dig_sum, site == 27)
# 
# #Make it only for 2015 and 2019
# # dig_s27 <- subset(dig_s27, year == 2015 | year == 2019) 
# 
# morph3 <- ggplot(dig_s27, aes(fill=Benthic_Morphology, y=Per_Area, x=ppq)) + geom_bar(stat = 'identity', position = 'stack') +facet_wrap(~year, scales = "fixed", ncol= 3)+ ylab("Site 27 % Coverage") + xlab("PPQ") #+theme(axis.text.x = element_text(angle = 270, vjust = 0.5, hjust=1)) 
# 
# morph3
# 
# 
# ### Site 15
# dig_s15 <- subset (dig_sum, site == 15)
# 
# #Make it only for 2015 and 2017
# dig_s15 <- subset(dig_s15, year == 2015 | year == 2017) 
# 
# morph4<- ggplot(dig_s15, aes(fill=Benthic_Morphology, y=Per_Area, x=ppq)) + geom_bar(stat = 'identity', position = 'stack') +facet_wrap(~year, scales = "fixed", ncol= 3)+ ylab("Site 15 % Coverage") + xlab("PPQ") #+theme(axis.text.x = element_text(angle = 270, vjust = 0.5, hjust=1))
# 
# morph4 
# 
# 
# 
# grid.arrange(morph1, morph4, nrow=2)
# 
# 
# 
# ########### Look at first 2 year timegap (2015-2017) #################
# #Site 5
# dig.1.5a <- subset (dig_sum, site == 5)
# 
# #Make it only for 2015 and 2019
# dig.1.5 <- subset(dig.1.5a, year == 2015 | year == 2017) 
# 
# #Plot
# ggplot(dig.1.5a, aes(fill=Benthic_Morphology, y=Per_Area, x=ppq)) + geom_bar(stat = 'identity', position = 'stack') +facet_wrap(~year, scales = "fixed", ncol= 3) + ylab("Site 5 % Coverage") + xlab("PPQ") #+theme(axis.text.x = element_text(angle = 270, vjust = 0.5, hjust=1)) 
# 
# 
# 
# 
# 
# ########## Look at last 2 year timegap (2017-2019) #################
# 
# 
# 
# 
# 
# # 
# # a22.1 <- aov(year~Per_Area*Benthic_Morphology, data = dig_s15)
# # summary(a22.1)
# # TukeyHSD(a22.1)
# # 
# # volume.change~region, data=CC.progress)
# ###########
# 
# ggplot(dig_subset, aes(fill=Benthic_Morphology, y=Per_Area, x=year.ppq)) + geom_bar(stat = 'identity', position = 'stack')  +facet_wrap(~site, scales = "fixed", ncol= 3) #+theme(axis.text.x = element_text(angle = 270, vjust = 0.5, hjust=1))
# 
# 
# #### Plot changes in rubble through time across disturbance gradient
# dig_sum
# 
# dig_DM <- subset(dig_sum, Benthic_Morphology == "Dead_Massive")
# dig_sand <- subset(dig_sum, Benthic_Morphology == "Sand")
# dig_rubble <- subset(dig_sum, Benthic_Morphology == "Rubble")
# 
# ggplot(dig_rubble, aes( y=Per_Area, x=year)) + geom_bar(stat = 'identity', position = 'stack') +theme(axis.text.x = element_text(angle = 270, vjust = 0.5, hjust=1)) +facet_wrap(~hum_dist, scales = "fixed", ncol= 3)
# 
# ggplot(dig_sand, aes( y=Per_Area, x=year)) + geom_bar(stat = 'identity', position = 'stack') +theme(axis.text.x = element_text(angle = 270, vjust = 0.5, hjust=1)) +facet_wrap(~hum_dist, scales = "fixed", ncol= 3)
# 
# ggplot(dig_DM, aes( y=Per_Area, x=year)) + geom_bar(stat = 'identity', position = 'stack') +theme(axis.text.x = element_text(angle = 270, vjust = 0.5, hjust=1)) +facet_wrap(~hum_dist, scales = "fixed", ncol= 3)
```


# 7. Julia's Duke Presentation Plots
```{r Duke presentation plots, echo=FALSE}
ggplot(mpq.1.3tp, aes(x = hum_dist, y=rug, fill=year.dist)) + geom_boxplot() +theme_classic(base_size = 10) + hum.colscale + xlab("") + ylab("Rugosity") + ylim(1.5, 3) + guides(fill=FALSE)  + theme(text = element_text(size=20)) + ggtitle("Surface Rugosity ~ Year") + theme(plot.title = element_text(hjust = 0.5))


#Plot by year
ggplot(mpq.1.3tp, aes(x = year, y=rug, fill=year)) + geom_boxplot() + year.colscale+theme_classic(base_size = 10) + xlab("") + ylab("Rugosity") + ylim(1.5, 3) + guides(fill=FALSE)+ theme(text = element_text(size=20))+ ggtitle("Surface Rugosity ~ Human Disturbance") + theme(plot.title = element_text(hjust = 0.5))


```
